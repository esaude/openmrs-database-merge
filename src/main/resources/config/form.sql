-- MySQL dump 10.13  Distrib 5.6.47, for Linux (x86_64)
--
-- Host: localhost    Database: fghmaster
-- ------------------------------------------------------
-- Server version	5.6.47

/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0 */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

--
-- Table structure for table `form`
--


/*!40101 SET character_set_client = @saved_cs_client */;

--
-- Dumping data for table `form`
--


/*!40000 ALTER TABLE `form` DISABLE KEYS */;
INSERT INTO `form` VALUES (1,'Template: Basic Form','0.1',1,0,'core elements needed for most forms',4,NULL,'<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2008-12-15 10:29:00',0,NULL,NULL,NULL,'e28a599e-1d5f-11e0-b929-000c29ad1d07'),(11,'PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO','0.1',89,0,'Processo de Hospital de Dia Pediatria 2/2',3,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/11-0.1-89.xsn\" solutionVersion=\"0.1.0.89\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/11-89\" id=\"11\" name=\"PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <pediatric_objective_exam openmrs_concept=\"1622^PEDIATRIC OBJECTIVE EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </weight_kg>\n      <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </height_cm>\n      <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </head_circumference>\n      <pediatric_diagnostic_exam multiple=\"1\" openmrs_concept=\"1616^PEDIATRIC DIAGNOSTIC EXAM^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\n            <shortness_of_breath openmrs_concept=\"5960^SHORTNESS OF BREATH^99DCT\">false</shortness_of_breath>\n            <dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false</dermatitis>\n            <lymphadenopathy openmrs_concept=\"161^LYMPHADENOPATHY^99DCT\">false</lymphadenopathy>\n            <parotidas_aumentadas openmrs_concept=\"1540^PAROTIDAS AUMENTADAS^99DCT\">false</parotidas_aumentadas>\n            <ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false</ictericas>\n            <fever openmrs_concept=\"5945^FEVER^99DCT\">false</fever>\n            <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\n      </pediatric_diagnostic_exam>\n      <oral_exam_non_specific openmrs_concept=\"1542^ORAL EXAM, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </oral_exam_non_specific>\n      <pulmonary_exam_auscultation_mv multiple=\"0\" openmrs_concept=\"1545^PULMONARY EXAM AUSCULTATION MV^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pulmonary_exam_auscultation_mv>\n      <pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false</sopro_tubarico>\n            <snoring openmrs_concept=\"1549^SNORING^99DCT\">false</snoring>\n            <murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false</murmur_anforico>\n            <fervor openmrs_concept=\"1548^FERVOR^99DCT\">false</fervor>\n      </pulmonary_exam_auscultation>\n      <cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false</s3_gallop>\n            <cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false</cardiac_murmur>\n            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n            <abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false</abnormal_sounds>\n            <left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false</left_ventricular_lift>\n            <right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false</right_ventricular_lift>\n            <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\n            <diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false</diastolic_descresendo_murmur>\n            <holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false</holosystolic_murmur>\n            <diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false</diastolic_rumble>\n            <systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false</systolic_ejection_murmur>\n            <pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false</pericardial_friction_rub>\n            <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\n            <arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false</arrythmia>\n      </cardiac_exam_findings>\n      <ap_te multiple=\"0\" openmrs_concept=\"1552^PULMONARY AUSCULTATION TE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ap_te>\n      <liver_size openmrs_concept=\"5153^LIVER SIZE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </liver_size>\n      <spleen_size openmrs_concept=\"5195^SPLEEN SIZE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </spleen_size>\n      <other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </other_masses_description>\n      <perineum_description openmrs_concept=\"1554^PERINEUM, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </perineum_description>\n      <membros_superiores openmrs_concept=\"1555^MEMBROS SUPERIORES^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </membros_superiores>\n      <membros_inferiores openmrs_concept=\"1556^LOWER LIMBS^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </membros_inferiores>\n      <neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neurological_exam_other>\n      <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </non_coded_diagnosis>\n    </pediatric_objective_exam>\n    <pediatric_blood_tests openmrs_concept=\"1618^PEDIATRIC BLOOD TESTS^99DCT\" openmrs_datatype=\"ZZ\">\n      <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hemoglobin>\n      <hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hematocrit>\n      <platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </platelets>\n      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </white_blood_cells>\n      <neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neutrophils>\n      <lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymphocytes>\n      <eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </eosinophils>\n      <erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </erythrocyte_sedimentation_rate>\n      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_protein>\n      <globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </globulinas>\n      <immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </immuno_globulin_hiv>\n      <urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </urinary_albumin>\n      <fa openmrs_concept=\"1521^FA^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </fa>\n      <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_count>\n      <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_percent>\n      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load>\n      <hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load_log>\n      <total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_bilirubin>\n      <direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </direct_bilirubin>\n      <serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glutamic-oxaloacetic_transaminase>\n      <serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glutamic-pyruvic_transaminase>\n      <lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lactate_dehydrogenase>\n      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </blood_urea_nitrogen>\n      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_creatinine>\n      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_sodium>\n      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_potassium>\n      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glucose>\n      <serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_albumin>\n      <alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </alkaline_phosphatase>\n      <mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mean_corpuscular_volume>\n    </pediatric_blood_tests>\n    <pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false</urina_piocytes>\n        <urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false</urine_erithrocytes>\n        <urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false</urine_leucocytes>\n        <epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false</epithelial_cells>\n        <urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false</urine_cilinders>\n    </pediatric_urinalysis>\n    <pediatric_feces_test multiple=\"1\" openmrs_concept=\"1620^PEDIATRIC FECES TEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <feces_giardia openmrs_concept=\"1527^FECES GIARDIA^99DCT\">false</feces_giardia>\n        <feces_e_hystolitica openmrs_concept=\"1529^FECES E HYSTOLITICA^99DCT\">false</feces_e_hystolitica>\n        <feces_strongolides openmrs_concept=\"1526^FECES STRONGOLIDES^99DCT\">false</feces_strongolides>\n        <fezes_trichuria openmrs_concept=\"1528^FEZES TRICHURIA^99DCT\">false</fezes_trichuria>\n        <feces_ascaris openmrs_concept=\"1530^FECES ASCARIS^99DCT\">false</feces_ascaris>\n    </pediatric_feces_test>\n    <feces_other openmrs_concept=\"1531^FECES OTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </feces_other>\n    <lcr_patologico multiple=\"0\" openmrs_concept=\"1532^LCR PATHOLOGY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </lcr_patologico>\n    <x-ray_chest multiple=\"1\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n        <pulmonary_effusion openmrs_concept=\"1136^PULMONARY EFFUSION^99DCT\">false</pulmonary_effusion>\n        <miliary_changes openmrs_concept=\"1137^MILIARY CHANGES^99DCT\">false</miliary_changes>\n        <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <infiltrate openmrs_concept=\"6049^INFILTRATE^99DCT\">false</infiltrate>\n        <diffuse_non-miliary_changes openmrs_concept=\"6050^DIFFUSE NON-MILIARY CHANGES^99DCT\">false</diffuse_non-miliary_changes>\n        <cavitary_lesion openmrs_concept=\"6052^CAVITARY LESION^99DCT\">false</cavitary_lesion>\n        <infiltrate_retuculonodular openmrs_concept=\"1641^INFILTRATE RETUCULONODULAR^99DCT\">false</infiltrate_retuculonodular>\n        <infiltrado_reticular openmrs_concept=\"1643^INFILTRADO RETICULAR^99DCT\">false</infiltrado_reticular>\n        <derrames openmrs_concept=\"1647^DERRAMES^99DCT\">false</derrames>\n        <condensacoes openmrs_concept=\"1644^CONDENSACOES^99DCT\">false</condensacoes>\n        <adenopatias_aumentadas openmrs_concept=\"1645^ADENOPATIAS AUMENTADAS^99DCT\">false</adenopatias_aumentadas>\n        <mediastino_alargado openmrs_concept=\"1646^MEDIASTINO ALARGADO^99DCT\">false</mediastino_alargado>\n        <negative openmrs_concept=\"664^NEGATIVE^99DCT\">false</negative>\n        <positive openmrs_concept=\"703^POSITIVE^99DCT\">false</positive>\n        <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\n    </x-ray_chest>\n    <x-ray_chest_other openmrs_concept=\"1642^X-RAY, CHEST, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </x-ray_chest_other>\n    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </non_coded_diagnosis>\n    <pediatric_initial_treatment openmrs_concept=\"1648^PEDIATRIC INITIAL TREATMENT^99DCT\" openmrs_datatype=\"ZZ\">\n      <patient_is_on_antibiotic_treatment multiple=\"0\" openmrs_concept=\"1533^PATIENT IS ON ANTIBIOTIC TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_is_on_antibiotic_treatment>\n      <antibiotics_prescribed multiple=\"1\" openmrs_concept=\"1621^ANTIBIOTICS PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <penicillin openmrs_concept=\"784^PENICILLIN^99DCT\">false</penicillin>\n            <cefuroxime openmrs_concept=\"737^CEFUROXIME^99DCT\">false</cefuroxime>\n            <cefixime openmrs_concept=\"963^CEFIXIME^99DCT\">false</cefixime>\n            <amoxicillin openmrs_concept=\"265^AMOXICILLIN^99DCT\">false</amoxicillin>\n            <cetirizine openmrs_concept=\"779^CETIRIZINE^99DCT\">false</cetirizine>\n            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n            <trimethoprim openmrs_concept=\"91^TRIMETHOPRIM^99DCT\">false</trimethoprim>\n      </antibiotics_prescribed>\n      <antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </antiretroviral_use>\n      <current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n            <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\n            <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\n            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n            <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\n            <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\n            <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\n            <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\n            <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\n            <zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_lamivudine_nevirapine>\n            <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\n            <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\n            <zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false</zidovudine_lamivudine_efavirenz>\n            <zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false</zidovudine_lamivudine_nelfinavir>\n            <stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false</stavudinelamivudineefavirennz>\n            <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\n            <d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false</d4t-40>\n            <d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false</d4t-30>\n            <lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false</lopinavir_and_ritonavir>\n            <triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false</triomune-30>\n            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n            <triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false</triomune-40>\n            <ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false</ddi_125>\n            <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\n            <ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false</ddi_200>\n            <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\n            <zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</zidovudinelamivudinelopinavir>\n            <zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false</zidovudinelamivudinesaquinavir>\n            <stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false</stavudinelamivudineabacavir>\n            <stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</stavudinelamivudinelopinavir>\n            <abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false</abacavirlamivudineefavirenz>\n            <abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false</abc3tcnvp>\n            <abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false</abc3tclpv>\n            <tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false</tdfazt3tclpv>\n            <tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false</tdf3tclpv>\n            <aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false</aztddilpv>\n            <d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false</d4t_63tcnvp>\n            <d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false</d4t_63tcefv>\n            <d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false</d4t_63tcabc>\n            <d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false</d4t_63tclpv>\n            <azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false</azt603tcnvp>\n            <azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false</azt603tcefv>\n            <azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false</azt603tcabc>\n            <azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false</azt603tclpv>\n            <ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false</ddi50abclpv>\n            <ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false</ddi250ecabclpv>\n      </current_antiretroviral_drugs_used_for_treatment>\n      <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cotrimoxazole_use>\n      <cotrimoxazole_use_specifically openmrs_concept=\"1536^COTRIMOXAZOLE USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cotrimoxazole_use_specifically>\n      <vitamin_a multiple=\"0\" openmrs_concept=\"1535^VITAMIN A TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </vitamin_a>\n      <vitamin_a_use_specifically openmrs_concept=\"1537^VITAMIN A USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </vitamin_a_use_specifically>\n      <antifungal_use multiple=\"0\" openmrs_concept=\"1538^ANTIFUNGAL USE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </antifungal_use>\n      <antifungal_use_specifically openmrs_concept=\"1539^ANTIFUNGAL USE, SPECIFICALLY^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </antifungal_use_specifically>\n      <treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </treatment_non_specific>\n    </pediatric_initial_treatment>\n  </obs>\n  <problem_list openmrs_concept=\"1284^PROBLEM LIST^99DCT\" openmrs_datatype=\"ZZ\">\n    <problem_added multiple=\"0\" openmrs_concept=\"6042^PROBLEM ADDED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </problem_added>\n    <problem_resolved multiple=\"0\" openmrs_concept=\"6097^PROBLEM RESOLVED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </problem_resolved>\n  </problem_list>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-27 11:59:39',0,NULL,NULL,NULL,'e28a6ace-1d5f-11e0-b929-000c29ad1d07'),(13,'Template: MISAU header','0.1',39,0,'header without address, separate line for each item',4,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/13-0.1-39.xsn\" solutionVersion=\"0.1.0.39\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/13-39\" id=\"13\" name=\"Template: MISAU header\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </placeholder>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:11',0,NULL,NULL,NULL,'e28a7550-1d5f-11e0-b929-000c29ad1d07'),(37,'ADULTO: SEGUIMENTO','0.1',106,0,'Ficha de Seguimento adulto',6,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/37-0.1-106.xsn\" solutionVersion=\"0.1.0.106\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/37-106\" id=\"37\" name=\"ADULTO: SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </temperature_c>\n    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </weight_kg>\n    <altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </altura_cm>\n    <systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </systolic_blood_pressure>\n    <month_of_current_gestation openmrs_concept=\"5992^MONTH OF CURRENT GESTATION^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </month_of_current_gestation>\n    <mozambique_stage_1_adult multiple=\"1\" openmrs_concept=\"1564^STAGE 1 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false</asymptomatic_hiv_infection>\n    </mozambique_stage_1_adult>\n    <mozambique_stage_2_adult multiple=\"1\" openmrs_concept=\"1565^STAGE 2 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\n        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\n        <hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_less_than_ten_percent>\n        <hiv_staging_-_minor_mucocutaneous_manifestations openmrs_concept=\"5330^HIV STAGING - MINOR MUCOCUTANEOUS MANIFESTATIONS^99DCT\">false</hiv_staging_-_minor_mucocutaneous_manifestations>\n    </mozambique_stage_2_adult>\n    <mozambique_stage_3_adult multiple=\"1\" openmrs_concept=\"1566^STAGE 3 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <candidiasis_vaginal openmrs_concept=\"298^CANDIDIASIS, VAGINAL^99DCT\">false</candidiasis_vaginal>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false</hiv_staging_-_severe_bacterial_infection>\n        <oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false</oral_hairy_leukoplakia>\n        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\n        <bedridden_less_than_50_percent_of_time openmrs_concept=\"1567^BEDRIDDEN LESS THAN 50% OF TIME^99DCT\">false</bedridden_less_than_50_percent_of_time>\n        <hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_greater_than_ten_percent>\n        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\n        <hiv_staging_-_tuberculosis_within_year openmrs_concept=\"5338^HIV STAGING - TUBERCULOSIS WITHIN YEAR^99DCT\">false</hiv_staging_-_tuberculosis_within_year>\n    </mozambique_stage_3_adult>\n    <mozambique_stage_4_adult multiple=\"1\" openmrs_concept=\"1569^STAGE 4 ADULT, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\n        <cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false</cervical_cancer>\n        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\n        <hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false</hiv_staging_-_cytomegalovirus_disease>\n        <hiv_staging_-_mycobacterium_other openmrs_concept=\"5043^HIV STAGING - MYCOBACTERIUM, OTHER^99DCT\">false</hiv_staging_-_mycobacterium_other>\n        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\n        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n        <bedridden_more_than_50_percent_of_time openmrs_concept=\"1568^BEDRIDDEN MORE THAN 50% OF TIME^99DCT\">false</bedridden_more_than_50_percent_of_time>\n        <wasting_syndrome openmrs_concept=\"823^WASTING SYNDROME^99DCT\">false</wasting_syndrome>\n        <hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false</hiv_staging_-_cryptococcosis_extrapulmonary>\n        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\n        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\n        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\n        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\n        <encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false</encephalopathy>\n    </mozambique_stage_4_adult>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </non_coded_diagnosis>\n    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_who_hiv_stage>\n    <documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      <neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neutrophils_absolute_count_obs>\n      <lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymphocites_absolute_count_obs>\n      <hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hemoglobin_obs>\n      <ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ast_obs>\n      <alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </alt_obs>\n      <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_absolute_obs>\n    </documented_observed_laboratory_data>\n    <current_antiretroviral_drugs_used_for_treatment multiple=\"1\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\n        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\n        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\n        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\n        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\n        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\n        <zidovudine_lamivudine_nevirapine openmrs_concept=\"1651^ZIDOVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_lamivudine_nevirapine>\n        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\n        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\n        <zidovudine_lamivudine_efavirenz openmrs_concept=\"1703^ZIDOVUDINE + LAMIVUDINE + EFAVIRENZ^99DCT\">false</zidovudine_lamivudine_efavirenz>\n        <zidovudine_lamivudine_nelfinavir openmrs_concept=\"1702^ZIDOVUDINE + LAMIVUDINE + NELFINAVIR^99DCT\">false</zidovudine_lamivudine_nelfinavir>\n        <stavudinelamivudineefavirennz openmrs_concept=\"1827^STAVUDINE+LAMIVUDINE+EFAVIRENNZ^99DCT\">false</stavudinelamivudineefavirennz>\n        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\n        <d4t-40 openmrs_concept=\"625^STAVUDINE^99DCT^6^d4T-40^99RX\">false</d4t-40>\n        <d4t-30 openmrs_concept=\"625^STAVUDINE^99DCT^5^d4T-30^99RX\">false</d4t-30>\n        <lopinavir_and_ritonavir openmrs_concept=\"794^LOPINAVIR AND RITONAVIR^99DCT\">false</lopinavir_and_ritonavir>\n        <triomune-30 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^2^Triomune-30^99RX\">false</triomune-30>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <triomune-40 openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT^3^Triomune-40^99RX\">false</triomune-40>\n        <ddi_125 openmrs_concept=\"796^DIDANOSINE^99DCT^9^DDI 125^99RX\">false</ddi_125>\n        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\n        <ddi_200 openmrs_concept=\"796^DIDANOSINE^99DCT^10^DDI 200^99RX\">false</ddi_200>\n        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\n        <zidovudinelamivudinelopinavir openmrs_concept=\"6100^ZIDOVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</zidovudinelamivudinelopinavir>\n        <zidovudinelamivudinesaquinavir openmrs_concept=\"6101^ZIDOVUDINE+LAMIVUDINE+SAQUINAVIR^99DCT\">false</zidovudinelamivudinesaquinavir>\n        <stavudinelamivudineabacavir openmrs_concept=\"6102^STAVUDINE+LAMIVUDINE+ABACAVIR^99DCT\">false</stavudinelamivudineabacavir>\n        <stavudinelamivudinelopinavir openmrs_concept=\"6103^STAVUDINE+LAMIVUDINE+LOPINAVIR^99DCT\">false</stavudinelamivudinelopinavir>\n        <abacavirlamivudineefavirenz openmrs_concept=\"6104^ABACAVIR+LAMIVUDINE+EFAVIRENZ^99DCT\">false</abacavirlamivudineefavirenz>\n        <abc3tcnvp openmrs_concept=\"6105^ABC+3TC+NVP^99DCT\">false</abc3tcnvp>\n        <abc3tclpv openmrs_concept=\"6106^ABC+3TC+LPV^99DCT\">false</abc3tclpv>\n        <tdfazt3tclpv openmrs_concept=\"6107^TDF+AZT+3TC+LPV^99DCT\">false</tdfazt3tclpv>\n        <tdf3tclpv openmrs_concept=\"6108^TDF+3TC+LPV^99DCT\">false</tdf3tclpv>\n        <aztddilpv openmrs_concept=\"6109^AZT+DDI+LPV^99DCT\">false</aztddilpv>\n        <d4t_63tcnvp openmrs_concept=\"6110^D4T 6+3TC+NVP^99DCT\">false</d4t_63tcnvp>\n        <d4t_63tcefv openmrs_concept=\"6111^D4T 6+3TC+EFV^99DCT\">false</d4t_63tcefv>\n        <d4t_63tcabc openmrs_concept=\"6112^D4T 6+3TC+ABC^99DCT\">false</d4t_63tcabc>\n        <d4t_63tclpv openmrs_concept=\"6113^D4T 6+3TC+LPV^99DCT\">false</d4t_63tclpv>\n        <azt603tcnvp openmrs_concept=\"6114^AZT60+3TC+NVP^99DCT\">false</azt603tcnvp>\n        <azt603tcefv openmrs_concept=\"6115^AZT60+3TC+EFV^99DCT\">false</azt603tcefv>\n        <azt603tcabc openmrs_concept=\"6116^AZT60+3TC+ABC^99DCT\">false</azt603tcabc>\n        <azt603tclpv openmrs_concept=\"6117^AZT60+3TC+LPV^99DCT\">false</azt603tclpv>\n        <ddi50abclpv openmrs_concept=\"6118^DDI50+ABC+LPV^99DCT\">false</ddi50abclpv>\n        <ddi250ecabclpv openmrs_concept=\"6119^DDI250Ec+ABC+LPV^99DCT\">false</ddi250ecabclpv>\n    </current_antiretroviral_drugs_used_for_treatment>\n    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_plan>\n    <diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </diastolic_blood_pressure>\n    <treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </treatment_prescribed>\n    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit_date>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </isoniazid_use>\n    <hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\n        <malaria openmrs_concept=\"123^MALARIA^99DCT\">false</malaria>\n        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\n        <polyp openmrs_concept=\"2142^POLYP^99DCT\">false</polyp>\n        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\n        <prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false</prolapse>\n    </hipoteses_de_diagnosticos_outros>\n    <nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\n        <basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false</basic_food_basket>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false</enriched_porridge>\n    </nutritional_supplement>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 18:01:09',0,NULL,NULL,NULL,'e28aa7aa-1d5f-11e0-b929-000c29ad1d07'),(42,'Template: MISAU header, full address','0.1',47,0,'Template for MISAU forms with full address',4,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header, full address\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/42-0.1-47.xsn\" solutionVersion=\"0.1.0.47\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/42-47\" id=\"42\" name=\"Template: MISAU header, full address\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </placeholder>\n    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </organization>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:14',0,NULL,NULL,NULL,'e28aabd8-1d5f-11e0-b929-000c29ad1d07'),(44,'PEDIATRIA: SEGUIMENTO','0.1',82,0,'Ficha de Seguimento pediatria',9,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/44-0.1-82.xsn\" solutionVersion=\"0.1.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/44-82\" id=\"44\" name=\"PEDIATRIA: SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <mozambique_stage_1_pediatric multiple=\"1\" openmrs_concept=\"1558^STAGE 1 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\n        <asymptomatic_hiv_infection openmrs_concept=\"5327^ASYMPTOMATIC HIV INFECTION^99DCT\">false</asymptomatic_hiv_infection>\n        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\n        <hiv_staging_-_persistent_generalized_lymphadenopathy openmrs_concept=\"5328^HIV STAGING - PERSISTENT GENERALIZED LYMPHADENOPATHY^99DCT\">false</hiv_staging_-_persistent_generalized_lymphadenopathy>\n        <hiv_staging_-_weight_loss_less_than_ten_percent openmrs_concept=\"5332^HIV STAGING - WEIGHT LOSS LESS THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_less_than_ten_percent>\n        <minor_cutaneous_manifestations openmrs_concept=\"1296^MINOR CUTANEOUS MANIFESTATIONS^99DCT\">false</minor_cutaneous_manifestations>\n    </mozambique_stage_1_pediatric>\n    <mozambique_stage_2_pediatric multiple=\"1\" openmrs_concept=\"1561^STAGE 2 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\n        <pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false</pneumonia_tuberculous>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\n        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\n        <hiv_staging_-_weight_loss_greater_than_ten_percent openmrs_concept=\"5339^HIV STAGING - WEIGHT LOSS GREATER THAN TEN PERCENT^99DCT\">false</hiv_staging_-_weight_loss_greater_than_ten_percent>\n        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\n        <hepatosplenomegaly openmrs_concept=\"825^HEPATOSPLENOMEGALY^99DCT\">false</hepatosplenomegaly>\n        <recurrent_oral_ulcer openmrs_concept=\"2065^RECURRENT ORAL ULCER^99DCT\">false</recurrent_oral_ulcer>\n        <parotid_enlargement openmrs_concept=\"1210^PAROTID ENLARGEMENT^99DCT\">false</parotid_enlargement>\n        <hiv_staging_-_recurrent_upper_respiratory_infection openmrs_concept=\"5012^HIV STAGING - RECURRENT UPPER RESPIRATORY INFECTION^99DCT\">false</hiv_staging_-_recurrent_upper_respiratory_infection>\n        <molluscum_contagiosum openmrs_concept=\"1212^MOLLUSCUM CONTAGIOSUM^99DCT\">false</molluscum_contagiosum>\n        <linear_gingival_erythema openmrs_concept=\"2064^LINEAR GINGIVAL ERYTHEMA^99DCT\">false</linear_gingival_erythema>\n        <herpes_zoster openmrs_concept=\"836^HERPES ZOSTER^99DCT\">false</herpes_zoster>\n    </mozambique_stage_2_pediatric>\n    <mozambique_stage_3_pediatric multiple=\"1\" openmrs_concept=\"1562^STAGE 3 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\n        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\n        <hiv_staging_-_salmonella_septicemia openmrs_concept=\"5354^HIV STAGING - SALMONELLA SEPTICEMIA^99DCT\">false</hiv_staging_-_salmonella_septicemia>\n        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\n        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\n        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\n        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\n        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\n        <hiv_staging_-_lymphoid_interstitial_pneumonia openmrs_concept=\"5024^HIV STAGING - LYMPHOID INTERSTITIAL PNEUMONIA^99DCT\">false</hiv_staging_-_lymphoid_interstitial_pneumonia>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n        <hiv_staging_-_hsv_stomatitis openmrs_concept=\"5020^HIV STAGING - HSV STOMATITIS^99DCT\">false</hiv_staging_-_hsv_stomatitis>\n        <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\n        <oral_hairy_leukoplakia openmrs_concept=\"5337^ORAL HAIRY LEUKOPLAKIA^99DCT\">false</oral_hairy_leukoplakia>\n        <pneumonia_tuberculous openmrs_concept=\"42^PNEUMONIA, TUBERCULOUS^99DCT\">false</pneumonia_tuberculous>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\n        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\n        <tuberculosis_ganglionic openmrs_concept=\"2063^TUBERCULOSIS GANGLIONIC^99DCT\">false</tuberculosis_ganglionic>\n        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\n        <hiv_staging_-_refractory_anemia openmrs_concept=\"1217^HIV STAGING - REFRACTORY ANEMIA^99DCT\">false</hiv_staging_-_refractory_anemia>\n        <candidiasis_oral openmrs_concept=\"5334^CANDIDIASIS, ORAL^99DCT\">false</candidiasis_oral>\n    </mozambique_stage_3_pediatric>\n    <stage_4_pediatric_mozambique multiple=\"1\" openmrs_concept=\"2066^STAGE 4 PEDIATRIC, MOZAMBIQUE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\n        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\n        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\n        <cervical_cancer openmrs_concept=\"1570^CERVICAL CANCER^99DCT\">false</cervical_cancer>\n        <hiv_staging_-_cytomegalovirus_disease openmrs_concept=\"5035^HIV STAGING - CYTOMEGALOVIRUS DISEASE^99DCT\">false</hiv_staging_-_cytomegalovirus_disease>\n        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\n        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n        <hiv_staging_-_nonresponsive_herpes_simplex_virus openmrs_concept=\"1216^HIV STAGING - NONRESPONSIVE HERPES SIMPLEX VIRUS^99DCT\">false</hiv_staging_-_nonresponsive_herpes_simplex_virus>\n        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\n        <hiv_staging_-_cryptococcosis_extrapulmonary openmrs_concept=\"5033^HIV STAGING - CRYPTOCOCCOSIS, EXTRAPULMONARY^99DCT\">false</hiv_staging_-_cryptococcosis_extrapulmonary>\n        <hiv_staging_-_severe_bacterial_infection openmrs_concept=\"5333^HIV STAGING - SEVERE BACTERIAL INFECTION^99DCT\">false</hiv_staging_-_severe_bacterial_infection>\n        <hiv_staging_-_disseminated_endemic_mycosis openmrs_concept=\"5350^HIV STAGING - DISSEMINATED ENDEMIC MYCOSIS^99DCT\">false</hiv_staging_-_disseminated_endemic_mycosis>\n        <hiv_staging_-_mycobacterium_avium_complex openmrs_concept=\"5044^HIV STAGING - MYCOBACTERIUM AVIUM COMPLEX^99DCT\">false</hiv_staging_-_mycobacterium_avium_complex>\n        <nephropathy openmrs_concept=\"5025^NEPHROPATHY^99DCT\">false</nephropathy>\n        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\n        <chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false</chronic_malnutrition>\n        <encephalopathy openmrs_concept=\"5345^ENCEPHALOPATHY^99DCT\">false</encephalopathy>\n        <mycobacterium_tuberculosis_extrapulmonary openmrs_concept=\"5042^MYCOBACTERIUM TUBERCULOSIS, EXTRAPULMONARY^99DCT\">false</mycobacterium_tuberculosis_extrapulmonary>\n        <hiv_staging_-_mucocutaneous_herpes_simplex openmrs_concept=\"5344^HIV STAGING - MUCOCUTANEOUS HERPES SIMPLEX^99DCT\">false</hiv_staging_-_mucocutaneous_herpes_simplex>\n    </stage_4_pediatric_mozambique>\n    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_patient_hiv_positive>\n    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_dna_polymerase_chain_reaction_qualitative>\n    <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </temperature_c>\n    <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </head_circumference>\n    <altura_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </altura_cm>\n    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </weight_kg>\n    <weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </weight_divided_by_height_as_a_percentage>\n    <psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </psychomotor_development>\n    <treatment_non_specific openmrs_concept=\"1541^TREATMENT, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </treatment_non_specific>\n    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </non_coded_diagnosis>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n    <documented_observed_laboratory_data openmrs_concept=\"1689^DOCUMENTED OBSERVED LABORATORY DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      <neutrophils_absolute_count_obs openmrs_concept=\"1690^NEUTROPHILS ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neutrophils_absolute_count_obs>\n      <lymphocites_absolute_count_obs openmrs_concept=\"1691^LYMPHOCITES ABSOLUTE COUNT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymphocites_absolute_count_obs>\n      <hemoglobin_obs openmrs_concept=\"1692^HEMOGLOBIN OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hemoglobin_obs>\n      <ast_obs openmrs_concept=\"1693^AST OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ast_obs>\n      <alt_obs openmrs_concept=\"1694^ALT OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </alt_obs>\n      <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_absolute_obs>\n      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </white_blood_cells>\n      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_protein>\n      <urinary_albumin openmrs_concept=\"849^URINARY ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </urinary_albumin>\n      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load>\n    </documented_observed_laboratory_data>\n    <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^REGIMEN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_antiretroviral_drugs_used_for_treatment>\n    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_plan>\n    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hospital_slash_clinic>\n      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </diagnosis_for_hospitalization>\n      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_hospital_stay_entry>\n      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </data_of_hospital_stay_exit>\n      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hosptal_treatment>\n    </hospitalizations>\n    <treatment_prescribed multiple=\"0\" openmrs_concept=\"1719^TREATMENT PRESCRIBED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </treatment_prescribed>\n    <side_effect_with_severity openmrs_concept=\"1365^SIDE EFFECT WITH SEVERITY^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </side_effect_with_severity>\n    <reason_antiretrovirals_stopped multiple=\"0\" openmrs_concept=\"1252^REASON ANTIRETROVIRALS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_antiretrovirals_stopped>\n    <adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </adherence>\n    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit_date>\n    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_who_hiv_stage>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </isoniazid_use>\n    <nutritional_supplement multiple=\"1\" openmrs_concept=\"2152^NUTRITIONAL SUPPLEMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\n        <basic_food_basket openmrs_concept=\"2151^BASIC FOOD BASKET^99DCT\">false</basic_food_basket>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <enriched_porridge openmrs_concept=\"2150^ENRICHED PORRIDGE^99DCT\">false</enriched_porridge>\n    </nutritional_supplement>\n    <hipoteses_de_diagnosticos_outros multiple=\"1\" openmrs_concept=\"1406^OTHER DIAGNOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <anemia openmrs_concept=\"3^ANEMIA^99DCT\">false</anemia>\n        <malaria openmrs_concept=\"123^MALARIA^99DCT\">false</malaria>\n        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\n        <polyp openmrs_concept=\"2142^POLYP^99DCT\">false</polyp>\n        <rectovaginal_fistula openmrs_concept=\"1218^RECTOVAGINAL FISTULA^99DCT\">false</rectovaginal_fistula>\n        <prolapse openmrs_concept=\"2141^PROLAPSE^99DCT\">false</prolapse>\n    </hipoteses_de_diagnosticos_outros>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 18:23:36',0,NULL,NULL,NULL,'e28ac028-1d5f-11e0-b929-000c29ad1d07'),(50,'ADULTO: PROCESSO PARTE B - EXAME CLINICO','1',82,0,'Processo de Hospital de Dia 2/2',1,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/50-1-82.xsn\" solutionVersion=\"1.0.0.82\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/50-82\" id=\"50\" name=\"ADULTO: PROCESSO PARTE B - EXAME CLINICO\" version=\"1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <vital_data openmrs_concept=\"1673^VITAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      <written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </written_history>\n      <general_physical_state multiple=\"0\" openmrs_concept=\"1382^GENERAL PHYSICAL STATE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </general_physical_state>\n      <systolic_blood_pressure openmrs_concept=\"5085^SYSTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </systolic_blood_pressure>\n      <diastolic_blood_pressure openmrs_concept=\"5086^DIASTOLIC BLOOD PRESSURE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </diastolic_blood_pressure>\n      <temperature_c openmrs_concept=\"5088^TEMPERATURE (C)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </temperature_c>\n      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </weight_kg>\n      <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </height_cm>\n      <body_mass_index openmrs_concept=\"1342^BODY MASS INDEX^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </body_mass_index>\n      <exame_mucosas multiple=\"1\" openmrs_concept=\"1415^EXAME OF MUCOSAL MEMBRANES^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <conjuntivas openmrs_concept=\"1418^CONJUNTIVAS^99DCT\">false</conjuntivas>\n            <anictericas openmrs_concept=\"1420^ANICTERICAS^99DCT\">false</anictericas>\n            <ictericas openmrs_concept=\"1419^ICTERICAS^99DCT\">false</ictericas>\n            <descoradas openmrs_concept=\"1417^DESCORADAS^99DCT\">false</descoradas>\n            <coradas openmrs_concept=\"1416^CORADAS^99DCT\">false</coradas>\n      </exame_mucosas>\n      <findings_of_the_oral_cavity multiple=\"0\" openmrs_concept=\"1672^FINDINGS OF THE ORAL CAVITY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </findings_of_the_oral_cavity>\n      <type_of_oral_sores openmrs_concept=\"1424^TYPE OF ORAL SORES^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </type_of_oral_sores>\n    </vital_data>\n    <skin_exam_findings multiple=\"0\" openmrs_concept=\"1120^SKIN EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </skin_exam_findings>\n    <skin_exam openmrs_concept=\"1674^SKIN EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      <type_of_skin_lesion openmrs_concept=\"1423^TYPE OF SKIN LESION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </type_of_skin_lesion>\n      <anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </anatomic_locations>\n    </skin_exam>\n    <is_patient_hydrated multiple=\"0\" openmrs_concept=\"1425^IS PATIENT HYDRATED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_patient_hydrated>\n    <lymph_node_exam_findings multiple=\"1\" openmrs_concept=\"1121^LYMPH NODE EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <submandibular openmrs_concept=\"504^SUBMANDIBULAR^99DCT\">false</submandibular>\n        <supraclavicular openmrs_concept=\"505^SUPRACLAVICULAR^99DCT\">false</supraclavicular>\n        <inguinal openmrs_concept=\"506^INGUINAL^99DCT\">false</inguinal>\n        <cervical openmrs_concept=\"643^CERVICAL^99DCT\">false</cervical>\n        <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n        <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n        <axillary openmrs_concept=\"5112^AXILLARY^99DCT\">false</axillary>\n        <other_inguinal openmrs_concept=\"1426^OTHER INGUINAL^99DCT\">false</other_inguinal>\n    </lymph_node_exam_findings>\n    <cardiological_exam openmrs_concept=\"1676^CARDIOLOGICAL EXAM^99DCT\" openmrs_datatype=\"ZZ\">\n      <pulse openmrs_concept=\"5087^PULSE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pulse>\n      <cardiac_exam_findings multiple=\"1\" openmrs_concept=\"1124^CARDIAC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <s3_gallop openmrs_concept=\"550^S3 GALLOP^99DCT\">false</s3_gallop>\n            <cardiac_murmur openmrs_concept=\"562^CARDIAC MURMUR^99DCT\">false</cardiac_murmur>\n            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n            <abnormal_sounds openmrs_concept=\"1117^ABNORMAL SOUNDS^99DCT\">false</abnormal_sounds>\n            <left_ventricular_lift openmrs_concept=\"5156^LEFT VENTRICULAR LIFT^99DCT\">false</left_ventricular_lift>\n            <right_ventricular_lift openmrs_concept=\"5157^RIGHT VENTRICULAR LIFT^99DCT\">false</right_ventricular_lift>\n            <evidence_of_cardiac_enlargement openmrs_concept=\"5158^EVIDENCE OF CARDIAC ENLARGEMENT^99DCT\">false</evidence_of_cardiac_enlargement>\n            <diastolic_descresendo_murmur openmrs_concept=\"5160^DIASTOLIC DESCRESENDO MURMUR^99DCT\">false</diastolic_descresendo_murmur>\n            <holosystolic_murmur openmrs_concept=\"5162^HOLOSYSTOLIC MURMUR^99DCT\">false</holosystolic_murmur>\n            <diastolic_rumble openmrs_concept=\"5164^DIASTOLIC RUMBLE^99DCT\">false</diastolic_rumble>\n            <systolic_ejection_murmur openmrs_concept=\"5166^SYSTOLIC EJECTION MURMUR^99DCT\">false</systolic_ejection_murmur>\n            <pericardial_friction_rub openmrs_concept=\"5176^PERICARDIAL FRICTION RUB^99DCT\">false</pericardial_friction_rub>\n            <chronic_obstructive_pulmonary_disease openmrs_concept=\"1295^CHRONIC OBSTRUCTIVE PULMONARY DISEASE^99DCT\">false</chronic_obstructive_pulmonary_disease>\n            <arrythmia openmrs_concept=\"1395^ARRYTHMIA^99DCT\">false</arrythmia>\n      </cardiac_exam_findings>\n    </cardiological_exam>\n    <pulmonary_exam_set openmrs_concept=\"1675^PULMONARY EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <pulmonary_exam multiple=\"0\" openmrs_concept=\"1427^PULMONARY EXAM^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pulmonary_exam>\n      <respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </respiratory_rate>\n      <pulmonary_auscultation_non_specific openmrs_concept=\"1543^PULMONARY AUSCULTATION, NON SPECIFIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pulmonary_auscultation_non_specific>\n      <pulmonary_exam_auscultation multiple=\"1\" openmrs_concept=\"1629^PULMONARY EXAM AUSCULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <sopro_tubarico openmrs_concept=\"1550^SOPRO TUBARICO^99DCT\">false</sopro_tubarico>\n            <snoring openmrs_concept=\"1549^SNORING^99DCT\">false</snoring>\n            <murmur_anforico openmrs_concept=\"1551^MURMUR ANFORICO^99DCT\">false</murmur_anforico>\n            <fervor openmrs_concept=\"1548^FERVOR^99DCT\">false</fervor>\n      </pulmonary_exam_auscultation>\n    </pulmonary_exam_set>\n    <abdominal_exam_set openmrs_concept=\"1677^ABDOMINAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <abdominal_exam_findings multiple=\"1\" openmrs_concept=\"1125^ABDOMINAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <ascites openmrs_concept=\"581^ASCITES^99DCT\">false</ascites>\n            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n            <hepatomegaly openmrs_concept=\"5008^HEPATOMEGALY^99DCT\">false</hepatomegaly>\n            <splenomegaly openmrs_concept=\"5009^SPLENOMEGALY^99DCT\">false</splenomegaly>\n            <mass_abdominal openmrs_concept=\"5103^MASS, ABDOMINAL^99DCT\">false</mass_abdominal>\n            <abdominal_tenderness openmrs_concept=\"5105^ABDOMINAL TENDERNESS^99DCT\">false</abdominal_tenderness>\n            <distended openmrs_concept=\"1397^DISTENDED^99DCT\">false</distended>\n            <flatulence openmrs_concept=\"1398^FLATULENCE^99DCT\">false</flatulence>\n      </abdominal_exam_findings>\n      <abdominal_exam_other openmrs_concept=\"1396^ABDOMINAL EXAM, OTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </abdominal_exam_other>\n    </abdominal_exam_set>\n    <genital_exam_set openmrs_concept=\"1679^GENITAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <urogenital_exam_findings multiple=\"1\" openmrs_concept=\"1126^UROGENITAL EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n            <not_done openmrs_concept=\"1118^NOT DONE^99DCT\">false</not_done>\n            <secretions openmrs_concept=\"1399^SECRETIONS^99DCT\">false</secretions>\n            <condylomas openmrs_concept=\"1400^CONDYLOMAS^99DCT\">false</condylomas>\n            <ulcers openmrs_concept=\"1602^ULCERS^99DCT\">false</ulcers>\n      </urogenital_exam_findings>\n      <genital_exam_findings_non_coded openmrs_concept=\"1678^GENITAL EXAM FINDINGS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </genital_exam_findings_non_coded>\n    </genital_exam_set>\n    <neurological_exam_set openmrs_concept=\"1681^NEUROLOGICAL EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <neurologic_exam_findings multiple=\"1\" openmrs_concept=\"1129^NEUROLOGIC EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <seizure openmrs_concept=\"206^SEIZURE^99DCT\">false</seizure>\n            <cranial_nerve_abnormalities openmrs_concept=\"599^CRANIAL NERVE ABNORMALITIES^99DCT\">false</cranial_nerve_abnormalities>\n            <normal openmrs_concept=\"1115^NORMAL^99DCT\">false</normal>\n            <abnormal openmrs_concept=\"1116^ABNORMAL^99DCT\">false</abnormal>\n            <asymmetric_reflexes openmrs_concept=\"1199^ASYMMETRIC REFLEXES^99DCT\">false</asymmetric_reflexes>\n            <abnormal_gait openmrs_concept=\"5108^ABNORMAL GAIT^99DCT\">false</abnormal_gait>\n            <decreased_sensation openmrs_concept=\"5135^DECREASED SENSATION^99DCT\">false</decreased_sensation>\n            <abnormal_tone openmrs_concept=\"5264^ABNORMAL TONE^99DCT\">false</abnormal_tone>\n            <focal_weakness openmrs_concept=\"6005^FOCAL WEAKNESS^99DCT\">false</focal_weakness>\n            <irritability openmrs_concept=\"6023^IRRITABILITY^99DCT\">false</irritability>\n            <paresi openmrs_concept=\"1401^PARESI^99DCT\">false</paresi>\n            <hemiparesis openmrs_concept=\"828^HEMIPARESIS^99DCT\">false</hemiparesis>\n            <peripheral_neuropathy openmrs_concept=\"821^PERIPHERAL NEUROPATHY^99DCT\">false</peripheral_neuropathy>\n            <nuchal_rigidity openmrs_concept=\"5170^NUCHAL RIGIDITY^99DCT\">false</nuchal_rigidity>\n      </neurologic_exam_findings>\n      <type_of_paralysis_non_coded openmrs_concept=\"1680^TYPE OF PARALYSIS, NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </type_of_paralysis_non_coded>\n      <neurological_exam_other openmrs_concept=\"1407^NEUROLOGICAL EXAM OTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neurological_exam_other>\n    </neurological_exam_set>\n    <extremities_exam_set openmrs_concept=\"1683^EXTREMITIES EXAM SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <extremity_exam_findings multiple=\"0\" openmrs_concept=\"1127^EXTREMITY EXAM FINDINGS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </extremity_exam_findings>\n      <anatomic_locations multiple=\"0\" openmrs_concept=\"1239^ANATOMIC LOCATIONS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </anatomic_locations>\n    </extremities_exam_set>\n    <extremities_exam_other_non_coded openmrs_concept=\"1682^EXTREMITIES EXAM, OTHER NON CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </extremities_exam_other_non_coded>\n    <karnofsky_performance_score openmrs_concept=\"5283^KARNOFSKY PERFORMANCE SCORE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </karnofsky_performance_score>\n    <non_coded_diagnosis openmrs_concept=\"1649^NON CODED DIAGNOSIS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </non_coded_diagnosis>\n    <counceling_date openmrs_concept=\"1475^COUNCELING DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counceling_date>\n    <thereputic_plan openmrs_concept=\"1474^THEREPUTIC PLAN^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </thereputic_plan>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-10-23 10:15:56',13,'2011-01-11 15:23:07',0,NULL,NULL,NULL,'e28ad2ac-1d5f-11e0-b929-000c29ad1d07'),(51,'TARV: FRIDA','0.1',68,0,'Registo Individual de Dispesas Medicamentos',18,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: FRIDA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/51-0.1-68.xsn\" solutionVersion=\"0.1.0.68\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/51-68\" id=\"51\" name=\"TARV: FRIDA\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <posology openmrs_concept=\"1711^POSOLOGY^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </posology>\n    <duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </duration>\n    <quantity_prescribed openmrs_concept=\"1712^QUANTITY PRESCRIBED^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </quantity_prescribed>\n    <pills_left_over openmrs_concept=\"1713^PILLS LEFT OVER^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </pills_left_over>\n    <adherence multiple=\"0\" openmrs_concept=\"1714^ADHERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </adherence>\n    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </medication_quantity_available>\n    <antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </antiretroviral_plan_-_tarv_start>\n    <exit_from_arv_treatment multiple=\"0\" openmrs_concept=\"1708^EXIT FROM ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </exit_from_arv_treatment>\n    <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_antiretroviral_drugs_used_for_treatment>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit_date>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:05',0,NULL,NULL,NULL,'e28ae562-1d5f-11e0-b929-000c29ad1d07'),(56,'Template: MISAU header, compact','0.1',92,0,'DO NOT USE \r\nHeader without address made as small as possible',4,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"Template: MISAU header, compact\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/56-0.1-92.xsn\" solutionVersion=\"0.1.0.92\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/56-92\" id=\"56\" name=\"Template: MISAU header, compact\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient.tribe openmrs_attribute=\"tribe\" openmrs_table=\"patient\">$!{patient.attributeMap.Tribe.hydratedObject.tribeId}^$!{patient.attributeMap.Tribe.hydratedObject.name}</patient.tribe>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <return_visit_date openmrs_concept=\"5096^RETURN VISIT DATE FOR ARV DRUG^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit_date>\n    <placeholder openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </placeholder>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:13',0,NULL,NULL,NULL,'e28b1406-1d5f-11e0-b929-000c29ad1d07'),(60,'LABORATORIO GERAL','0.1',116,0,'Ficha Laboratorio Todos resultados',13,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"LABORATORIO GERAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/60-0.1-116.xsn\" solutionVersion=\"0.1.0.116\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/60-116\" id=\"60\" name=\"LABORATORIO GERAL\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <biochemistry_laboratory_set openmrs_concept=\"1633^BIOCHEMISTRY LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <total_protein openmrs_concept=\"717^TOTAL PROTEIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_protein>\n      <serum_albumin openmrs_concept=\"848^SERUM ALBUMIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_albumin>\n      <globulinas openmrs_concept=\"1520^GLOBULINS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </globulinas>\n      <total_bilirubin openmrs_concept=\"655^TOTAL BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_bilirubin>\n      <direct_bilirubin openmrs_concept=\"1297^DIRECT BILIRUBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </direct_bilirubin>\n      <serum_glutamic-oxaloacetic_transaminase openmrs_concept=\"653^SERUM GLUTAMIC-OXALOACETIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glutamic-oxaloacetic_transaminase>\n      <serum_glutamic-pyruvic_transaminase openmrs_concept=\"654^SERUM GLUTAMIC-PYRUVIC TRANSAMINASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glutamic-pyruvic_transaminase>\n      <lactate_dehydrogenase openmrs_concept=\"1014^LACTATE DEHYDROGENASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lactate_dehydrogenase>\n      <alkaline_phosphatase openmrs_concept=\"785^ALKALINE PHOSPHATASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </alkaline_phosphatase>\n      <amylase openmrs_concept=\"1299^AMYLASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </amylase>\n      <total_cholesterol openmrs_concept=\"1006^TOTAL CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </total_cholesterol>\n      <high-density_lipoprotein_cholesterol openmrs_concept=\"1007^HIGH-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </high-density_lipoprotein_cholesterol>\n      <low-density_lipoprotein_cholesterol openmrs_concept=\"1008^LOW-DENSITY LIPOPROTEIN CHOLESTEROL^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </low-density_lipoprotein_cholesterol>\n      <creatine_kinase openmrs_concept=\"1011^CREATINE KINASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </creatine_kinase>\n      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_creatinine>\n      <gamma_glutamyl_transferase openmrs_concept=\"2077^GAMMA GLUTAMYL TRANSFERASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gamma_glutamyl_transferase>\n      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glucose>\n      <serum_lactate openmrs_concept=\"1012^SERUM LACTATE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_lactate>\n      <serum_lipase openmrs_concept=\"1013^SERUM LIPASE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_lipase>\n      <triglycerides openmrs_concept=\"1009^TRIGLYCERIDES^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </triglycerides>\n      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </blood_urea_nitrogen>\n      <serum_chloride openmrs_concept=\"1134^SERUM CHLORIDE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_chloride>\n      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_potassium>\n      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_sodium>\n    </biochemistry_laboratory_set>\n    <hemogram_kx21n openmrs_concept=\"1723^HEMOGRAM KX21N^99DCT\" openmrs_datatype=\"ZZ\">\n      <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hemoglobin>\n      <hematocrit openmrs_concept=\"1015^HEMATOCRIT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hematocrit>\n      <mean_corpuscular_volume openmrs_concept=\"851^MEAN CORPUSCULAR VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mean_corpuscular_volume>\n      <platelets openmrs_concept=\"729^PLATELETS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </platelets>\n      <white_blood_cells openmrs_concept=\"678^WHITE BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </white_blood_cells>\n      <absolute_neutrophil_count openmrs_concept=\"1330^ABSOLUTE NEUTROPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </absolute_neutrophil_count>\n      <lymphocytes openmrs_concept=\"1021^LYMPHOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymphocytes>\n      <neutrophils openmrs_concept=\"1022^NEUTROPHILS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </neutrophils>\n      <absolute_lymphocyte_count openmrs_concept=\"952^ABSOLUTE LYMPHOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </absolute_lymphocyte_count>\n      <eosinophils openmrs_concept=\"1024^EOSINOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </eosinophils>\n      <absolute_eosinophil_count openmrs_concept=\"1332^ABSOLUTE EOSINOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </absolute_eosinophil_count>\n      <basophils openmrs_concept=\"1025^BASOPHILS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </basophils>\n      <absolute_basophil_count openmrs_concept=\"1333^ABSOLUTE BASOPHIL COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </absolute_basophil_count>\n      <monocytes openmrs_concept=\"1023^MONOCYTES^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </monocytes>\n      <absolute_monocyte_count openmrs_concept=\"1331^ABSOLUTE MONOCYTE COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </absolute_monocyte_count>\n      <red_blood_cells openmrs_concept=\"679^RED BLOOD CELLS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </red_blood_cells>\n      <mean_cell_hemoglobin_concentration openmrs_concept=\"1017^MEAN CELL HEMOGLOBIN CONCENTRATION^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mean_cell_hemoglobin_concentration>\n      <mean_corpuscular_hemoglobin openmrs_concept=\"1018^MEAN CORPUSCULAR HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mean_corpuscular_hemoglobin>\n      <red_cell_distribution_width openmrs_concept=\"1016^RED CELL DISTRIBUTION WIDTH^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </red_cell_distribution_width>\n      <erythrocyte_sedimentation_rate openmrs_concept=\"855^ERYTHROCYTE SEDIMENTATION RATE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </erythrocyte_sedimentation_rate>\n      <blood_typing multiple=\"0\" openmrs_concept=\"300^BLOOD TYPING^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </blood_typing>\n      <mean_platelet_volume openmrs_concept=\"1307^MEAN PLATELET VOLUME^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mean_platelet_volume>\n      <vdrl multiple=\"0\" openmrs_concept=\"299^VDRL^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </vdrl>\n    </hemogram_kx21n>\n    <serum_laboratory_set openmrs_concept=\"1640^SERUM LABORATORY SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <blood_urea_nitrogen openmrs_concept=\"857^BLOOD UREA NITROGEN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </blood_urea_nitrogen>\n      <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_creatinine>\n      <serum_sodium openmrs_concept=\"1132^SERUM SODIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_sodium>\n      <serum_potassium openmrs_concept=\"1133^SERUM POTASSIUM^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_potassium>\n      <serum_glucose openmrs_concept=\"887^SERUM GLUCOSE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </serum_glucose>\n    </serum_laboratory_set>\n    <immunology openmrs_concept=\"1639^IMMUNOLOGY^99DCT\" openmrs_datatype=\"ZZ\">\n      <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </rapid_plasma_reagin>\n      <immuno_globulin_hiv openmrs_concept=\"1519^IMMUNO GLOBULIN HIV^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </immuno_globulin_hiv>\n      <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_count>\n      <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </cd4_percent>\n    </immunology>\n    <virology_tests openmrs_concept=\"1632^VIROLOGY TESTS^99DCT\" openmrs_datatype=\"ZZ\">\n      <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load>\n      <hiv_viral_load_log openmrs_concept=\"1518^HIV VIRAL LOAD LOG^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load_log>\n      <viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </viral_load_exam_type>\n      <hiv_viral_load_qualitative multiple=\"0\" openmrs_concept=\"1305^HIV VIRAL LOAD, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_viral_load_qualitative>\n    </virology_tests>\n    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_dna_polymerase_chain_reaction_qualitative>\n    <pediatric_urinalysis multiple=\"1\" openmrs_concept=\"1619^PEDIATRIC URINALYSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <urina_piocytes openmrs_concept=\"1525^URINA PIOCYTES^99DCT\">false</urina_piocytes>\n        <urine_erithrocytes openmrs_concept=\"1523^URINE ERITHROCYTES^99DCT\">false</urine_erithrocytes>\n        <urine_leucocytes openmrs_concept=\"1522^URINE LEUCOCYTES^99DCT\">false</urine_leucocytes>\n        <epithelial_cells openmrs_concept=\"666^EPITHELIAL CELLS^99DCT\">false</epithelial_cells>\n        <urine_cilinders openmrs_concept=\"1524^URINE CILINDERS^99DCT\">false</urine_cilinders>\n    </pediatric_urinalysis>\n    <parasitology_feces multiple=\"0\" openmrs_concept=\"1635^PARASITOLOGY, FECES^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </parasitology_feces>\n    <serum_creatinine openmrs_concept=\"790^SERUM CREATININE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </serum_creatinine>\n    <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </sputum_for_acid_fast_bacilli>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',2,'2008-10-31 11:06:07',13,'2011-01-11 15:23:28',0,NULL,NULL,NULL,'e28b23a6-1d5f-11e0-b929-000c29ad1d07'),(62,'TARV: RASTREIO DE TUBERCULOSE','0.1',60,0,'Formulario de restrio de casos de suspeita de tuberculose em doentes com HIV',20,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: RASTREIO DE TUBERCULOSE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/62-0.1-60.xsn\" solutionVersion=\"0.1.0.60\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/62-60\" id=\"62\" name=\"TARV: RASTREIO DE TUBERCULOSE\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <tb_observations multiple=\"1\" openmrs_concept=\"1766^TB OBSERVATIONS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nightsweats_lasting_more_than_3_weeks openmrs_concept=\"1762^NIGHTSWEATS LASTING MORE THAN 3 WEEKS^99DCT\">false</nightsweats_lasting_more_than_3_weeks>\n        <cough_lasting_more_than_3_weeks openmrs_concept=\"1760^COUGH LASTING MORE THAN 3 WEEKS^99DCT\">false</cough_lasting_more_than_3_weeks>\n        <weight_loss_of_more_than_3_kg_in_last_month openmrs_concept=\"1764^WEIGHT LOSS OF MORE THAN 3 KG IN LAST MONTH^99DCT\">false</weight_loss_of_more_than_3_kg_in_last_month>\n        <coughing_up_blood openmrs_concept=\"1761^COUGHING UP BLOOD^99DCT\">false</coughing_up_blood>\n        <fever_lasting_more_than_3_weeks openmrs_concept=\"1763^FEVER LASTING MORE THAN 3 WEEKS^99DCT\">false</fever_lasting_more_than_3_weeks>\n        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\n    </tb_observations>\n    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tubuculosis_exams>\n      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sputum_for_acid_fast_bacilli>\n      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </x-ray_chest>\n      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ultrasound_tb>\n      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymph_node_biopsy>\n      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </paracentesis>\n      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </thoracentesis>\n      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </purified_protein_derivative>\n      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gastric_levage>\n      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </test_other>\n    </tuberculosis_exams_set>\n    <does_patient_have_tuberculosis multiple=\"0\" openmrs_concept=\"1785^DOES PATIENT HAVE TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </does_patient_have_tuberculosis>\n    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_tuberculosis>\n    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_drug_treatment_start_date>\n    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment>\n    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_tuberculosis_treatment_stopped>\n    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n    </tuberculosis_prophylaxis_started>\n    <reason_tuberculosis_prophylaxis_stopped multiple=\"0\" openmrs_concept=\"1266^REASON TUBERCULOSIS PROPHYLAXIS STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_tuberculosis_prophylaxis_stopped>\n    <service_providing_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1783^SERVICE PROVIDING TUBERCULOSIS TREATMENT ^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </service_providing_tuberculosis_treatment>\n    <service_providing_prophylaxis_treatment multiple=\"0\" openmrs_concept=\"1786^SERVICE PROVIDING PROPHYLAXIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </service_providing_prophylaxis_treatment>\n    <tuberculosis_drug_treatment_end_date openmrs_concept=\"6120^TUBERCULOSIS DRUG TREATMENT END DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_drug_treatment_end_date>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n    <isoniazid_use multiple=\"0\" openmrs_concept=\"6122^ISONIAZID USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </isoniazid_use>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-26 17:28:03',0,NULL,NULL,NULL,'e28b2fb8-1d5f-11e0-b929-000c29ad1d07'),(63,'TARV: ACONSELHAMENTO','1',73,0,'Ficha de aconselhamento Pré-TARV',19,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/63-1-73.xsn\" solutionVersion=\"1.0.0.73\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/63-73\" id=\"63\" name=\"TARV: ACONSELHAMENTO\" version=\"1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <counseling_session_number openmrs_concept=\"1724^COUNSELING SESSION NUMBER^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counseling_session_number>\n    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_who_hiv_stage>\n    <cd4_absolute_obs openmrs_concept=\"1695^CD4 ABSOLUTE OBS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cd4_absolute_obs>\n    <who_slash_cdc_staging_criteria_met multiple=\"0\" openmrs_concept=\"1248^WHO/CDC STAGING CRITERIA MET^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </who_slash_cdc_staging_criteria_met>\n    <date_of_counseling_session openmrs_concept=\"1758^DATE OF COUNSELING SESSION^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_counseling_session>\n    <counseling_session multiple=\"0\" openmrs_concept=\"1727^COUNSELING SESSION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counseling_session>\n    <confidante_present multiple=\"0\" openmrs_concept=\"1728^CONFIDANTE PRESENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </confidante_present>\n    <patient_understands_treatment_concepts multiple=\"0\" openmrs_concept=\"1729^PATIENT UNDERSTANDS TREATMENT CONCEPTS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_treatment_concepts>\n    <date_of_evaluation openmrs_concept=\"1730^DATE OF EVALUATION^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_evaluation>\n    <patient_knowledge_of_hiv_contraction openmrs_concept=\"1731^PATIENT KNOWLEDGE OF HIV CONTRACTION^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_knowledge_of_hiv_contraction>\n    <patient_knowledge_of_effect_of_hiv openmrs_concept=\"1732^PATIENT KNOWLEDGE OF EFFECT OF HIV^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_knowledge_of_effect_of_hiv>\n    <patient_understands_purpose_of_cd4 openmrs_concept=\"1733^PATIENT UNDERSTANDS PURPOSE OF CD4^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_purpose_of_cd4>\n    <patient_understands_importance_of_adherence openmrs_concept=\"1734^PATIENT UNDERSTANDS IMPORTANCE OF ADHERENCE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_importance_of_adherence>\n    <patient_knowledge_of_treatment_duration openmrs_concept=\"1735^PATIENT KNOWLEDGE OF TREATMENT DURATION^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_knowledge_of_treatment_duration>\n    <is_the_patient_interested_in_taking_arv multiple=\"0\" openmrs_concept=\"1736^IS THE PATIENT INTERESTED IN TAKING ARV^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_the_patient_interested_in_taking_arv>\n    <did_the_patient_sign_the_consent_form multiple=\"0\" openmrs_concept=\"1738^DID THE PATIENT SIGN THE CONSENT FORM^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </did_the_patient_sign_the_consent_form>\n    <did_the_patient_present_a_confidant multiple=\"0\" openmrs_concept=\"1739^DID THE PATIENT PRESENT A CONFIDANT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </did_the_patient_present_a_confidant>\n    <confidant_name openmrs_concept=\"1740^CONFIDANT NAME^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </confidant_name>\n    <confidant_relation_to_candidate openmrs_concept=\"1741^CONFIDANT RELATION TO CANDIDATE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </confidant_relation_to_candidate>\n    <does_the_confidant_live_in_the_patients_home multiple=\"0\" openmrs_concept=\"1742^DOES THE CONFIDANT LIVE IN THE PATIENTS HOME^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </does_the_confidant_live_in_the_patients_home>\n    <confidant_contact openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </confidant_contact>\n    <can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment multiple=\"0\" openmrs_concept=\"1743^CAN THE PATIENT VISIT THE HOSPITAL REGULARLY TO CONTINUE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </can_the_patient_visit_the_hospital_regularly_to_continue_arv_treatment>\n    <distance_from_patients_home_to_the_hospital multiple=\"0\" openmrs_concept=\"1747^DISTANCE FROM PATIENTS HOME TO THE HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </distance_from_patients_home_to_the_hospital>\n    <transportation_problems multiple=\"0\" openmrs_concept=\"1737^TRANSPORTATION PROBLEMS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </transportation_problems>\n    <problems_with_food_security multiple=\"0\" openmrs_concept=\"1759^PROBLEMS WITH FOOD SECURITY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </problems_with_food_security>\n    <other_problems openmrs_concept=\"1748^OTHER PROBLEMS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_problems>\n    <arv_adherence_risk multiple=\"0\" openmrs_concept=\"1749^ARV ADHERENCE RISK^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </arv_adherence_risk>\n    <drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false</tobacco>\n        <alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false</alcohol_use>\n        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\n    </drug_habits>\n    <does_the_patient_suffer_from_depression multiple=\"0\" openmrs_concept=\"1750^DOES THE PATIENT SUFFER FROM DEPRESSION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </does_the_patient_suffer_from_depression>\n    <history_of_poor_adherence openmrs_concept=\"1751^HISTORY OF POOR ADHERENCE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </history_of_poor_adherence>\n    <does_the_patient_understand_the_regimen_of_treatment multiple=\"0\" openmrs_concept=\"1752^DOES THE PATIENT UNDERSTAND THE REGIMEN OF TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </does_the_patient_understand_the_regimen_of_treatment>\n    <patient_understands_arv_medicines_and_schedules openmrs_concept=\"1753^PATIENT UNDERSTANDS ARV MEDICINES AND SCHEDULES^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_arv_medicines_and_schedules>\n    <patient_understands_missed_arv_dose_and_vomiting openmrs_concept=\"1754^PATIENT UNDERSTANDS MISSED ARV DOSE AND VOMITING^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_missed_arv_dose_and_vomiting>\n    <patient_understands_arv_side_effects openmrs_concept=\"1755^PATIENT UNDERSTANDS ARV SIDE EFFECTS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_understands_arv_side_effects>\n    <is_the_patient_ready_to_take_arv_drugs multiple=\"0\" openmrs_concept=\"1756^IS THE PATIENT READY TO TAKE ARV DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_the_patient_ready_to_take_arv_drugs>\n    <comments_of_the_counselor openmrs_concept=\"1757^COMMENTS OF THE COUNSELOR^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </comments_of_the_counselor>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-11-06 11:20:42',13,'2011-01-11 15:24:01',0,NULL,NULL,NULL,'e28b3b52-1d5f-11e0-b929-000c29ad1d07'),(65,'TARV: SOLICITACAO','0.1',57,0,'Ficha de Solicitação de Medicamentos ARV',17,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: SOLICITACAO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/65-0.1-57.xsn\" solutionVersion=\"0.1.0.57\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/65-57\" id=\"65\" name=\"TARV: SOLICITACAO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </name_of_mother>\n    <patient_notified_of_tarv_details openmrs_concept=\"1592^PATIENT NOTIFIED OF TARV DETAILS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_notified_of_tarv_details>\n    <arv_treatment_plan openmrs_concept=\"1795^ARV TREATMENT PLAN^99DCT\" openmrs_datatype=\"ZZ\">\n      <current_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1088^CURRENT ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </current_antiretroviral_drugs_used_for_treatment>\n      <arv_dosage_amount openmrs_concept=\"1793^ARV DOSAGE AMOUNT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </arv_dosage_amount>\n      <arv_frequency openmrs_concept=\"1794^ARV FREQUENCY^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </arv_frequency>\n    </arv_treatment_plan>\n    <patient_has_exibited_symptoms_of_hiv_infection multiple=\"0\" openmrs_concept=\"1591^PATIENT HAS EXIBITED SYMPTOMS OF HIV INFECTION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_has_exibited_symptoms_of_hiv_infection>\n    <patient_catagory_for_tarv_request multiple=\"0\" openmrs_concept=\"1585^PATIENT CATAGORY FOR TARV REQUEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_catagory_for_tarv_request>\n    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_weeks_pregnant>\n    <nevaripin_used_during_delivery multiple=\"0\" openmrs_concept=\"1583^NEVARIPIN USED DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </nevaripin_used_during_delivery>\n    <patient_reported_current_pcp_prophylaxis multiple=\"0\" openmrs_concept=\"1109^PATIENT REPORTED CURRENT PCP PROPHYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_reported_current_pcp_prophylaxis>\n    <rifampicin_use multiple=\"0\" openmrs_concept=\"1582^RIFAMPICIN USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </rifampicin_use>\n    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cd4_count>\n    <cd4_percent openmrs_concept=\"730^CD4%^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cd4_percent>\n    <hiv_viral_load openmrs_concept=\"856^HIV VIRAL LOAD^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_viral_load>\n    <viral_load_exam_type multiple=\"0\" openmrs_concept=\"1574^VIRAL LOAD EXAM TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </viral_load_exam_type>\n    <months_perscription_is_valid openmrs_concept=\"1290^MONTHS PERSCRIPTION IS VALID^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </months_perscription_is_valid>\n    <justification_for_two_months_of_arv_medication openmrs_concept=\"1291^JUSTIFICATION FOR TWO MONTHS OF ARV MEDICATION^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </justification_for_two_months_of_arv_medication>\n    <clinical_hiv_manifestations multiple=\"1\" openmrs_concept=\"1788^CLINICAL HIV MANIFESTATIONS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <pneumocystic_carinii_pneumonia openmrs_concept=\"882^PNEUMOCYSTIC CARINII PNEUMONIA^99DCT\">false</pneumocystic_carinii_pneumonia>\n        <hiv_staging_-_lymphoma openmrs_concept=\"5041^HIV STAGING - LYMPHOMA^99DCT\">false</hiv_staging_-_lymphoma>\n        <mac openmrs_concept=\"1796^MAC^99DCT\">false</mac>\n        <kaposi_apos_s_sarcoma openmrs_concept=\"507^KAPOSI\'S SARCOMA^99DCT\">false</kaposi_apos_s_sarcoma>\n        <progressive_multifocal_leukoencephalopathy openmrs_concept=\"5046^PROGRESSIVE MULTIFOCAL LEUKOENCEPHALOPATHY^99DCT\">false</progressive_multifocal_leukoencephalopathy>\n        <hiv_staging_-_lymphoma_brain openmrs_concept=\"5040^HIV STAGING - LYMPHOMA, BRAIN^99DCT\">false</hiv_staging_-_lymphoma_brain>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n        <hiv_staging_-_adult_herpes_zoster openmrs_concept=\"5329^HIV STAGING - ADULT HERPES ZOSTER^99DCT\">false</hiv_staging_-_adult_herpes_zoster>\n        <toxoplasmosis openmrs_concept=\"5355^TOXOPLASMOSIS^99DCT\">false</toxoplasmosis>\n        <cryptococcosis openmrs_concept=\"1219^CRYPTOCOCCOSIS^99DCT\">false</cryptococcosis>\n        <tuberculosis openmrs_concept=\"58^TUBERCULOSIS^99DCT\">false</tuberculosis>\n        <hiv_staging_-_cryptosporidiosis openmrs_concept=\"5034^HIV STAGING - CRYPTOSPORIDIOSIS^99DCT\">false</hiv_staging_-_cryptosporidiosis>\n        <hiv_staging_-_histoplasmosis_disseminated openmrs_concept=\"5038^HIV STAGING - HISTOPLASMOSIS, DISSEMINATED^99DCT\">false</hiv_staging_-_histoplasmosis_disseminated>\n        <hiv_staging_-_infant_cytomegalovirus openmrs_concept=\"5017^HIV STAGING - INFANT CYTOMEGALOVIRUS^99DCT\">false</hiv_staging_-_infant_cytomegalovirus>\n    </clinical_hiv_manifestations>\n    <justification_to_change_arv_treatment multiple=\"0\" openmrs_concept=\"1792^JUSTIFICATION TO CHANGE ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </justification_to_change_arv_treatment>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:10',0,NULL,NULL,NULL,'e28b5c54-1d5f-11e0-b929-000c29ad1d07'),(67,'ADULTO: PROCESSO PARTE A - ANAMNESE','1.1',157,0,'Processo de Hospital de Dia 1/2',5,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/67-1.1-157.xsn\" solutionVersion=\"1.1.0.157\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/67-157\" id=\"67\" name=\"ADULTO: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_name>\n      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_surname>\n      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_telephone_number>\n    </personal_reference>\n    <other_personal_information openmrs_concept=\"1657^OTHER PERSONAL INFORMATION^99DCT\" openmrs_datatype=\"ZZ\">\n      <occupation openmrs_concept=\"1459^OCCUPATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </occupation>\n      <level_of_education multiple=\"0\" openmrs_concept=\"1443^LEVEL OF EDUCATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </level_of_education>\n      <number_of_household_members openmrs_concept=\"1656^NUMBER OF HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_household_members>\n    </other_personal_information>\n    <civil_information_for_hiv_postitive_patients openmrs_concept=\"1659^CIVIL INFORMATION FOR HIV POSTITIVE PATIENTS^99DCT\" openmrs_datatype=\"ZZ\">\n      <civil_status multiple=\"0\" openmrs_concept=\"1054^CIVIL STATUS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </civil_status>\n      <number_of_wives openmrs_concept=\"5557^NUMBER OF WIVES^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_wives>\n      <hiv_status_of_wives multiple=\"0\" openmrs_concept=\"1449^HIV STATUS OF WIVES^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_status_of_wives>\n      <patient_id_of_hiv_positive_wife openmrs_concept=\"1450^PATIENT ID OF HIV POSITIVE WIFE^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_id_of_hiv_positive_wife>\n      <other_partners openmrs_concept=\"1451^OTHER PARTNERS^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </other_partners>\n      <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_children>\n      <number_of_children_tested_for_hiv openmrs_concept=\"1452^NUMBER OF CHILDREN TESTED FOR HIV^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_children_tested_for_hiv>\n      <number_of_hiv_positive_children openmrs_concept=\"1453^NUMBER OF HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_hiv_positive_children>\n      <patient_id_for_hiv_positive_children openmrs_concept=\"1454^PATIENT ID FOR HIV POSITIVE CHILDREN^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_id_for_hiv_positive_children>\n    </civil_information_for_hiv_postitive_patients>\n    <social_status openmrs_concept=\"1660^SOCIAL STATUS^99DCT\" openmrs_datatype=\"ZZ\">\n      <refrigerator_in_home multiple=\"0\" openmrs_concept=\"1455^REFRIGERATOR IN HOME^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </refrigerator_in_home>\n      <home_electricity multiple=\"0\" openmrs_concept=\"5609^HOME ELECTRICITY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </home_electricity>\n    </social_status>\n    <entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_referal_type>\n      <entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_location_name>\n      <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_patient_code_at_location>\n    </entry_point_into_hiv_care_set>\n    <hiv_diagnostics openmrs_concept=\"1661^HIV DIAGNOSTICS^99DCT\" openmrs_datatype=\"ZZ\">\n      <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </is_patient_hiv_positive>\n      <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_received_counceling>\n    </hiv_diagnostics>\n    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_counceling>\n    <drug_habits multiple=\"1\" openmrs_concept=\"1389^DRUG HABIT(S)^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <tobacco openmrs_concept=\"1388^TOBACCO^99DCT\">false</tobacco>\n        <alcohol_use openmrs_concept=\"1603^ALCOHOL USE^99DCT\">false</alcohol_use>\n        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\n    </drug_habits>\n    <sexual_preference multiple=\"0\" openmrs_concept=\"1375^SEXUAL PREFERENCE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </sexual_preference>\n    <number_of_sexual_partners_in_the_last_3_months multiple=\"0\" openmrs_concept=\"1666^NUMBER OF SEXUAL PARTNERS IN THE LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_sexual_partners_in_the_last_3_months>\n    <gynacological_history openmrs_concept=\"1393^GYNACOLOGICAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      <gravida openmrs_concept=\"5624^GRAVIDA^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gravida>\n      <gpav_para openmrs_concept=\"1392^GPAV PARA^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gpav_para>\n      <gpav_aborted openmrs_concept=\"1390^GPAV ABORTED^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gpav_aborted>\n      <gpav_vivos openmrs_concept=\"1391^GPAV VIVOS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gpav_vivos>\n      <antecedentes_ginecologicos_outros openmrs_concept=\"1394^GYNECOLOGICAL HISTORY, OTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </antecedentes_ginecologicos_outros>\n      <date_of_last_menstration openmrs_concept=\"1465^DATE OF LAST MENSTRATION^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_last_menstration>\n    </gynacological_history>\n    <obstectric_history openmrs_concept=\"1668^OBSTECTRIC HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      <prior_abortion multiple=\"0\" openmrs_concept=\"1667^PRIOR ABORTION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prior_abortion>\n      <tratamento_ptv multiple=\"0\" openmrs_concept=\"1466^PMTCT TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tratamento_ptv>\n      <tratamento_ptv_quais multiple=\"0\" openmrs_concept=\"1467^PMTCT TREATMENT, SPECIFIC^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tratamento_ptv_quais>\n      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n      </prenatal_arv_medication_mother>\n      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant>\n      <pregnancy_due_date openmrs_concept=\"1600^PREGNANCY DUE DATE^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pregnancy_due_date>\n      <prior_delivery_date openmrs_concept=\"5599^PRIOR DELIVERY DATE^99DCT\" openmrs_datatype=\"TS\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prior_delivery_date>\n      <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pregant>\n    </obstectric_history>\n    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </infant_feeding_method>\n    <allergies_to_medicine openmrs_concept=\"1669^ALLERGIES TO MEDICINE^99DCT\" openmrs_datatype=\"ZZ\">\n      <medication_allergy multiple=\"0\" openmrs_concept=\"1601^MEDICATION ALLERGY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </medication_allergy>\n      <medication_allergies multiple=\"0\" openmrs_concept=\"1605^MEDICATION ALLERGIES^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </medication_allergies>\n      <medication_allergy_specific_non_coded openmrs_concept=\"1517^MEDICATION ALLERGY SPECIFIC NON CODED^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </medication_allergy_specific_non_coded>\n    </allergies_to_medicine>\n    <antiretroviral_use multiple=\"0\" openmrs_concept=\"1192^ANTIRETROVIRAL USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </antiretroviral_use>\n    <previous_antiretroviral_drugs_used_for_treatment multiple=\"0\" openmrs_concept=\"1087^PREVIOUS ANTIRETROVIRAL DRUGS USED FOR TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </previous_antiretroviral_drugs_used_for_treatment>\n    <adult_clinical_history multiple=\"0\" openmrs_concept=\"1670^ADULT CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </adult_clinical_history>\n    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </clinical_history_not_coded>\n    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hospital_slash_clinic>\n      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </diagnosis_for_hospitalization>\n      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_hospital_stay_entry>\n      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </data_of_hospital_stay_exit>\n      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hosptal_treatment>\n    </hospitalizations>\n    <hiv_exposure_adult_set openmrs_concept=\"1688^HIV EXPOSURE ADULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <hiv_exposure_through_surgery multiple=\"0\" openmrs_concept=\"1685^HIV EXPOSURE THROUGH SURGERY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_exposure_through_surgery>\n      <description_of_surgical_intervention openmrs_concept=\"1473^DESCRIPTION OF SURGICAL INTERVENTION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </description_of_surgical_intervention>\n      <hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_exposure_through_blood_transfusion>\n      <hiv_exposure_through_accident multiple=\"0\" openmrs_concept=\"1687^HIV EXPOSURE THROUGH ACCIDENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_exposure_through_accident>\n      <description_of_accident openmrs_concept=\"1435^DESCRIPTION OF ACCIDENT^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </description_of_accident>\n      <method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false</suspected_past_hiv_exposure>\n            <blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false</blood_transfusion>\n            <spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false</spouses_partner_suspected_hiv>\n            <contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false</contaminated_needle_stick>\n            <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\n            <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n            <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\n            <injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false</injections>\n            <surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false</surgical_intervention>\n            <dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false</dental_extraction>\n            <scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false</scarrification>\n            <accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false</accidental_exposure>\n      </method_of_hiv_exposure>\n    </hiv_exposure_adult_set>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-11-14 13:46:09',13,'2011-01-11 15:23:03',0,NULL,NULL,NULL,'e28b6096-1d5f-11e0-b929-000c29ad1d07'),(68,'PEDIATRIA: PROCESSO PARTE A - ANAMNESE','1.1',110,0,'Processo de Hospital de Dia Pediatria 1/2',7,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/68-1.1-110.xsn\" solutionVersion=\"1.1.0.110\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/68-110\" id=\"68\" name=\"PEDIATRIA: PROCESSO PARTE A - ANAMNESE\" version=\"1.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_telephone_number>\n      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_name>\n      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_surname>\n    </personal_reference>\n    <maternal_data openmrs_concept=\"1607^MATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </name_of_mother>\n      <age_of_mother openmrs_concept=\"1478^AGE OF MOTHER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </age_of_mother>\n      <mother_alive multiple=\"0\" openmrs_concept=\"1479^MOTHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mother_alive>\n      <mother_ill multiple=\"0\" openmrs_concept=\"1480^MOTHER ILL^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mother_ill>\n      <sickness_of_mother openmrs_concept=\"1481^SICKNESS OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sickness_of_mother>\n      <result_of_hiv_test_mother multiple=\"0\" openmrs_concept=\"1483^RESULT OF HIV TEST MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </result_of_hiv_test_mother>\n      <professsion_of_mother openmrs_concept=\"1482^PROFESSSION OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </professsion_of_mother>\n      <mother_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1484^MOTHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mother_on_antiretroviral_treatment>\n    </maternal_data>\n    <paternal_data openmrs_concept=\"1608^PATERNAL DATA^99DCT\" openmrs_datatype=\"ZZ\">\n      <name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </name_of_father>\n      <age_of_father openmrs_concept=\"1486^AGE OF FATHER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </age_of_father>\n      <father_alive multiple=\"0\" openmrs_concept=\"1487^FATHER ALIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </father_alive>\n      <father_ill multiple=\"0\" openmrs_concept=\"1488^FATHER ILL^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </father_ill>\n      <sickness_of_father openmrs_concept=\"1489^SICKNESS OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sickness_of_father>\n      <profession_of_father openmrs_concept=\"1490^PROFESSION OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </profession_of_father>\n      <result_of_hiv_test_father multiple=\"0\" openmrs_concept=\"1491^RESULT OF HIV TEST FATHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </result_of_hiv_test_father>\n      <father_on_antiretroviral_treatment multiple=\"0\" openmrs_concept=\"1492^FATHER ON ANTIRETROVIRAL TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </father_on_antiretroviral_treatment>\n    </paternal_data>\n    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_counceling>\n    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_patient_hiv_positive>\n    <entry_point_into_hiv_care_set openmrs_concept=\"1625^ENTRY POINT INTO HIV CARE, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_referal_type>\n      <entry_point_into_hiv_care_location_name openmrs_concept=\"1626^ENTRY POINT INTO HIV CARE, LOCATION NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_location_name>\n      <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </entry_point_into_hiv_care_patient_code_at_location>\n    </entry_point_into_hiv_care_set>\n    <pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\n        <tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false</tuberculosis_treatment_status>\n        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\n        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\n        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\n        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\n        <cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false</cough_persistent>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n    </pediatric_clinical_history>\n    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </clinical_history_not_coded>\n    <pediatric_personal_history openmrs_concept=\"1612^PEDIATRIC PERSONAL HISTORY^99DCT\" openmrs_datatype=\"ZZ\">\n      <method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </method_of_delivery>\n      <location_of_birth openmrs_concept=\"1505^LOCATION OF BIRTH^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </location_of_birth>\n      <pregnancy_to_term multiple=\"0\" openmrs_concept=\"1500^PREGNANCY TO TERM^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pregnancy_to_term>\n      <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </birth_weight_kg>\n      <perinatal_exposure_to_arv_mother multiple=\"0\" openmrs_concept=\"1501^PERINATAL EXPOSURE TO ARV, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </perinatal_exposure_to_arv_mother>\n      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n      </prenatal_arv_medication_mother>\n      <prenatal_exposure_to_arv_at_birth multiple=\"0\" openmrs_concept=\"1502^PRENATAL EXPOSURE TO ARV, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_exposure_to_arv_at_birth>\n      <perinatal_arv_medication_at_birth multiple=\"0\" openmrs_concept=\"1503^PERINATAL ARV MEDICATION, AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </perinatal_arv_medication_at_birth>\n      <newborn_pathology openmrs_concept=\"1506^NEWBORN PATHOLOGY^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </newborn_pathology>\n    </pediatric_personal_history>\n    <method_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1061^METHOD OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <suspected_past_hiv_exposure openmrs_concept=\"1062^SUSPECTED PAST HIV EXPOSURE^99DCT\">false</suspected_past_hiv_exposure>\n        <blood_transfusion openmrs_concept=\"1063^BLOOD TRANSFUSION^99DCT\">false</blood_transfusion>\n        <spouses_partner_suspected_hiv openmrs_concept=\"5564^SPOUSES PARTNER SUSPECTED HIV+^99DCT\">false</spouses_partner_suspected_hiv>\n        <contaminated_needle_stick openmrs_concept=\"181^CONTAMINATED NEEDLE STICK^99DCT\">false</contaminated_needle_stick>\n        <intravenous_drug_use openmrs_concept=\"105^INTRAVENOUS DRUG USE^99DCT\">false</intravenous_drug_use>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <unknown openmrs_concept=\"1067^UNKNOWN^99DCT\">false</unknown>\n        <injections openmrs_concept=\"1507^INJECTIONS^99DCT\">false</injections>\n        <surgical_intervention openmrs_concept=\"1472^SURGICAL INTERVENTION^99DCT\">false</surgical_intervention>\n        <dental_extraction openmrs_concept=\"1508^DENTAL EXTRACTION^99DCT\">false</dental_extraction>\n        <scarrification openmrs_concept=\"1509^SCARRIFICATION^99DCT\">false</scarrification>\n        <accidental_exposure openmrs_concept=\"1433^ACCIDENTAL EXPOSURE^99DCT\">false</accidental_exposure>\n    </method_of_hiv_exposure>\n    <hospitalizations openmrs_concept=\"1606^HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hospital_slash_clinic>\n      <diagnosis_for_hospitalization openmrs_concept=\"1469^DIAGNOSIS FOR HOSPITALIZATION^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </diagnosis_for_hospitalization>\n      <date_of_hospital_stay_entry openmrs_concept=\"1470^DATE OF HOSPITAL STAY, ENTRY^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_hospital_stay_entry>\n      <data_of_hospital_stay_exit openmrs_concept=\"1722^DATA OF HOSPITAL STAY, EXIT^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </data_of_hospital_stay_exit>\n      <hosptal_treatment openmrs_concept=\"1471^HOSPTAL TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hosptal_treatment>\n    </hospitalizations>\n    <pediatric_nutrition openmrs_concept=\"1614^PEDIATRIC NUTRITION^99DCT\" openmrs_datatype=\"ZZ\">\n      <child_breast_fed_in_past multiple=\"0\" openmrs_concept=\"6061^CHILD BREAST FED IN PAST^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </child_breast_fed_in_past>\n      <was_the_child_exclusivly_breastfed multiple=\"0\" openmrs_concept=\"1613^WAS THE CHILD EXCLUSIVLY BREASTFED^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </was_the_child_exclusivly_breastfed>\n      <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </age_weaned_from_breast_feeding_months>\n      <pav_complete multiple=\"0\" openmrs_concept=\"1511^PAV COMPLETE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </pav_complete>\n      <dpm_age_chronological_years openmrs_concept=\"1512^DPM AGE CHRONOLOGICAL YEARS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </dpm_age_chronological_years>\n      <dpm_age_chronological_months openmrs_concept=\"1513^DPM AGE CHRONOLOGICAL MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </dpm_age_chronological_months>\n      <bailey_years openmrs_concept=\"1514^BAILEY YEARS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </bailey_years>\n      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </bailey_months>\n    </pediatric_nutrition>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-11-14 14:06:20',13,'2011-01-11 15:23:34',0,NULL,NULL,NULL,'e28b6b0e-1d5f-11e0-b929-000c29ad1d07'),(71,'PTV: PRE-NATAL','0.1',72,0,'Livro de registo de consulta de Prevenção de Transmissão Vertical Pré-Natal',11,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: PRE-NATAL\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/71-0.1-72.xsn\" solutionVersion=\"0.1.0.72\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/71-72\" id=\"71\" name=\"PTV: PRE-NATAL\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <ptv_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()} </ptv_code>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <number_of_weeks_pregnant_at_encounter_date openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_weeks_pregnant_at_encounter_date>\n    <planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </planned_date_to_administer_nvp_during_pregnancy>\n    <antiretroviral_plan_-_tarv_start multiple=\"0\" openmrs_concept=\"1255^ANTIRETROVIRAL PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </antiretroviral_plan_-_tarv_start>\n    <azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother_-_azt multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother_-_azt>\n      <number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_when_starting_azt_profolaxis>\n    </azt_profalaxis_for_prevention_of_vertical_transmission>\n    <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </prenatal_visit_number>\n    <prenatal_arv_medication_mother_-_ctx multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </prenatal_arv_medication_mother_-_ctx>\n    <prescribed_fansidar openmrs_concept=\"1805^PRESCRIBED FANSIDAR^99DCT\" openmrs_datatype=\"ZZ\">\n      <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </fansidar_dose>\n      <prenatal_arv_medication_mother_-_fansidar multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother_-_fansidar>\n      <number_of_weeks_pregnant_during_first_dose_of_fansidar openmrs_concept=\"1809^NUMBER OF WEEKS PREGNANT DURING FIRST DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_during_first_dose_of_fansidar>\n      <number_of_weeks_pregnant_during_second_dose_of_fansidar openmrs_concept=\"1810^NUMBER OF WEEKS PREGNANT DURING SECOND DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_during_second_dose_of_fansidar>\n      <number_of_weeks_pregnant_during_third_dose_of_fansidar openmrs_concept=\"1811^NUMBER OF WEEKS PREGNANT DURING THIRD DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_during_third_dose_of_fansidar>\n      <number_of_weeks_pregnant_during_dose_of_fansidar openmrs_concept=\"2053^NUMBER OF WEEKS PREGNANT DURING DOSE OF FANSIDAR^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_during_dose_of_fansidar>\n    </prescribed_fansidar>\n    <nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother_-_nevirapine multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother_-_nevirapine>\n      <number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_when_starting_nevirapine>\n    </nevirapine_administered_during_prenatal_consultations>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n    <prevention_of_vertical_transmission_observations openmrs_concept=\"1799^PREVENTION OF VERTICAL TRANSMISSION OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </prevention_of_vertical_transmission_observations>\n    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant>\n      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_visit_number>\n    </visit_number_and_weeks_pregnant_ptv>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-11-14 17:17:56',13,'2011-01-11 15:23:57',0,NULL,NULL,NULL,'e28b77e8-1d5f-11e0-b929-000c29ad1d07'),(79,'PTV: MATERNIDADE','0.1',59,0,'Livro de consulta de Prevenção de Transmissão Vertical para Maternidade',23,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: MATERNIDADE\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/79-0.1-59.xsn\" solutionVersion=\"0.1.0.59\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/79-59\" id=\"79\" name=\"PTV: MATERNIDADE\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}</ptv_maternity_code>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hour_mother_entered_hospital_to_give_birth>\n    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_weeks_pregnant>\n    <dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </dilation_on_entering_hospital>\n    <administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother>\n      <nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </nevirapine_administered_at_home>\n      <hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hour_nvp_taken_in_maternity>\n      <patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_vomited_within_an_hour_of_taking_nevirapine>\n      <patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_took_nevirapine_in_maternity>\n    </administration_of_arv_during_delivery>\n    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </infant_feeding_method>\n    <time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </time_of_birth>\n    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </location_of_delivery>\n    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </birth_weight_kg>\n    <stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </stillborn>\n    <prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\n      <first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </first_dose_of_nevirapine_given_to_child_at_birth>\n      <_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\n      <mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mother_took_azt_syrup_home>\n    </prophylaxis_administered_to_newborn>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:52',0,NULL,NULL,NULL,'e28b810c-1d5f-11e0-b929-000c29ad1d07'),(80,'CCR: PROCESSO','0.1',65,0,'Processo de consulta de crianças em risco',8,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"CCR: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/80-0.1-65.xsn\" solutionVersion=\"0.1.0.65\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/80-65\" id=\"80\" name=\"CCR: PROCESSO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <ccr_nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(9).getIdentifier()}</ccr_nid>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <location_of_temporary_housing openmrs_concept=\"1832^LOCATION OF TEMPORARY HOUSING^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </location_of_temporary_housing>\n    <temporarily_living_in_the_home_of openmrs_concept=\"1833^TEMPORARILY LIVING IN THE HOME OF^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </temporarily_living_in_the_home_of>\n    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </name_of_mother>\n    <mothers_workplace openmrs_concept=\"1834^MOTHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </mothers_workplace>\n    <name_of_father openmrs_concept=\"1485^NAME OF FATHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </name_of_father>\n    <fathers_workplace openmrs_concept=\"1835^FATHERS WORKPLACE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </fathers_workplace>\n    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </location_of_delivery>\n    <method_of_delivery multiple=\"0\" openmrs_concept=\"5630^METHOD OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </method_of_delivery>\n    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </birth_weight_kg>\n    <prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n    </prevention_of_vertical_trasmission_child>\n    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n    </prenatal_arv_medication_mother>\n    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </infant_feeding_method>\n    <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </age_weaned_from_breast_feeding_months>\n    <duration_of_weaning multiple=\"0\" openmrs_concept=\"1839^DURATION OF WEANING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </duration_of_weaning>\n    <reason_for_weaning openmrs_concept=\"1840^REASON FOR WEANING^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_for_weaning>\n    <child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </child_feeding_method>\n    <reason_for_entering_child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1874^REASON FOR ENTERING CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <contact_with_tuberculosis openmrs_concept=\"1845^CONTACT WITH TUBERCULOSIS^99DCT\">false</contact_with_tuberculosis>\n        <mother_hiv_positive openmrs_concept=\"1586^MOTHER HIV POSITIVE^99DCT\">false</mother_hiv_positive>\n        <twin openmrs_concept=\"1846^TWIN^99DCT\">false</twin>\n        <sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year openmrs_concept=\"1843^SUDDEN WEANING OR EXCLUSIVE ARTIFICIAL FEEDING FOR MORE THAN ONE YEAR^99DCT\">false</sudden_weaning_or_exclusive_artificial_feeding_for_more_than_one_year>\n        <malnutrition openmrs_concept=\"68^MALNUTRITION^99DCT\">false</malnutrition>\n        <chronic_malnutrition openmrs_concept=\"1844^CHRONIC MALNUTRITION^99DCT\">false</chronic_malnutrition>\n        <child_without_mother openmrs_concept=\"1847^CHILD WITHOUT MOTHER^99DCT\">false</child_without_mother>\n        <premature_birth_or_low_birth_weight openmrs_concept=\"1842^PREMATURE BIRTH OR LOW BIRTH WEIGHT^99DCT\">false</premature_birth_or_low_birth_weight>\n    </reason_for_entering_child_at_risk_treatment>\n    <other_reason_for_enrollment_in_child_at_risk_clinic openmrs_concept=\"1848^OTHER REASON FOR ENROLLMENT IN CHILD AT RISK CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_reason_for_enrollment_in_child_at_risk_clinic>\n    <number_of_hospitalizations openmrs_concept=\"1849^NUMBER OF HOSPITALIZATIONS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_hospitalizations>\n    <hiv_exposure_through_blood_transfusion multiple=\"0\" openmrs_concept=\"1686^HIV EXPOSURE THROUGH BLOOD TRANSFUSION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_exposure_through_blood_transfusion>\n    <previous_illness openmrs_concept=\"1850^PREVIOUS ILLNESS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </previous_illness>\n    <family_member_has_tuberculosis multiple=\"0\" openmrs_concept=\"1851^FAMILY MEMBER HAS TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </family_member_has_tuberculosis>\n    <other_illnesses_in_the_family openmrs_concept=\"1852^OTHER ILLNESSES IN THE FAMILY^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_illnesses_in_the_family>\n    <number_of_adult_household_members openmrs_concept=\"1853^NUMBER OF ADULT HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_adult_household_members>\n    <number_of_child_household_members openmrs_concept=\"1854^NUMBER OF CHILD HOUSEHOLD MEMBERS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_child_household_members>\n    <type_of_house multiple=\"0\" openmrs_concept=\"1858^TYPE OF HOUSE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_house>\n    <patients_water_source multiple=\"0\" openmrs_concept=\"1862^PATIENTS WATER SOURCE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patients_water_source>\n    <patient_has_mosquito_net multiple=\"0\" openmrs_concept=\"1863^PATIENT HAS MOSQUITO NET^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_has_mosquito_net>\n    <patient_has_latrine multiple=\"0\" openmrs_concept=\"1864^PATIENT HAS LATRINE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_has_latrine>\n    <source_of_income multiple=\"0\" openmrs_concept=\"1875^SOURCE OF INCOME^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </source_of_income>\n    <other_source_of_income openmrs_concept=\"1876^OTHER SOURCE OF INCOME^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_source_of_income>\n    <house_call_observations openmrs_concept=\"1870^HOUSE CALL OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </house_call_observations>\n    <exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </exit_from_child_at_risk_treatment>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:22',0,NULL,NULL,NULL,'e28b9c3c-1d5f-11e0-b929-000c29ad1d07'),(81,'CCR: SEGUIMENTO','0.1',107,0,'Ficha de seguimento de processo de consulta de crianças em risco',10,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"CCR: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/81-0.1-107.xsn\" solutionVersion=\"0.1.0.107\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/81-107\" id=\"81\" name=\"CCR: SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encouter.location_name openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getLocation().getName()}</encouter.location_name>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </weight_kg>\n    <height_cm openmrs_concept=\"5090^HEIGHT (CM)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </height_cm>\n    <weight_divided_by_height_as_a_percentage openmrs_concept=\"1888^WEIGHT DIVIDED BY HEIGHT AS A PERCENTAGE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </weight_divided_by_height_as_a_percentage>\n    <head_circumference openmrs_concept=\"5314^HEAD CIRCUMFERENCE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </head_circumference>\n    <vaccinations_are_up_to_date multiple=\"0\" openmrs_concept=\"1889^VACCINATIONS ARE UP TO DATE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </vaccinations_are_up_to_date>\n    <pediatric_clinical_history multiple=\"1\" openmrs_concept=\"1610^PEDIATRIC CLINICAL HISTORY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\n        <tuberculosis_treatment_status openmrs_concept=\"5965^TUBERCULOSIS TREATMENT STATUS^99DCT\">false</tuberculosis_treatment_status>\n        <hiv_staging_-_serious_bacterial_infections openmrs_concept=\"5030^HIV STAGING - SERIOUS BACTERIAL INFECTIONS^99DCT\">false</hiv_staging_-_serious_bacterial_infections>\n        <failure_to_thrive openmrs_concept=\"5050^FAILURE TO THRIVE^99DCT\">false</failure_to_thrive>\n        <hiv_staging_-_recurrent_bacterial_pneumonia openmrs_concept=\"1215^HIV STAGING - RECURRENT BACTERIAL PNEUMONIA^99DCT\">false</hiv_staging_-_recurrent_bacterial_pneumonia>\n        <diarrhea_chronic openmrs_concept=\"5018^DIARRHEA, CHRONIC^99DCT\">false</diarrhea_chronic>\n        <cough_persistent openmrs_concept=\"1429^COUGH, PERSISTENT^99DCT\">false</cough_persistent>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <cohabitant_being_treated_for_tb openmrs_concept=\"1765^COHABITANT BEING TREATED FOR TB^99DCT\">false</cohabitant_being_treated_for_tb>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <hiv_staging-candidiasis_respiratory_tract openmrs_concept=\"5340^HIV STAGING-CANDIDIASIS, RESPIRATORY TRACT^99DCT\">false</hiv_staging-candidiasis_respiratory_tract>\n    </pediatric_clinical_history>\n    <written_history openmrs_concept=\"1671^WRITTEN HISTORY^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </written_history>\n    <child_at_risk_clinical_evaluation multiple=\"1\" openmrs_concept=\"1880^CHILD AT RISK CLINICAL EVALUATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <candidiasis openmrs_concept=\"204^CANDIDIASIS^99DCT\">false</candidiasis>\n        <pale_palms openmrs_concept=\"1879^PALE PALMS^99DCT\">false</pale_palms>\n        <fluid_secretion openmrs_concept=\"1878^FLUID SECRETION^99DCT\">false</fluid_secretion>\n        <dermatitis openmrs_concept=\"119^DERMATITIS^99DCT\">false</dermatitis>\n        <oedema openmrs_concept=\"460^OEDEMA^99DCT\">false</oedema>\n        <adenomegaly openmrs_concept=\"1877^ADENOMEGALY^99DCT\">false</adenomegaly>\n    </child_at_risk_clinical_evaluation>\n    <respiratory_rate openmrs_concept=\"5242^RESPIRATORY RATE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </respiratory_rate>\n    <clinical_history_not_coded openmrs_concept=\"1628^CLINICAL HISTORY, NOT CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </clinical_history_not_coded>\n    <psychomotor_development multiple=\"0\" openmrs_concept=\"1882^PSYCHOMOTOR DEVELOPMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </psychomotor_development>\n    <child_at_risk_treatment multiple=\"1\" openmrs_concept=\"1885^CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <plumpy_nut openmrs_concept=\"1884^PLUMPY NUT^99DCT\">false</plumpy_nut>\n        <mebendazole openmrs_concept=\"244^MEBENDAZOLE^99DCT\">false</mebendazole>\n        <vitamin_a openmrs_concept=\"1720^VITAMIN A^99DCT\">false</vitamin_a>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <multivitamin openmrs_concept=\"1883^MULTIVITAMIN^99DCT\">false</multivitamin>\n    </child_at_risk_treatment>\n    <child_at_risk_other_treatment openmrs_concept=\"1886^CHILD AT RISK, OTHER TREATMENT^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </child_at_risk_other_treatment>\n    <feeding_plan multiple=\"1\" openmrs_concept=\"985^FEEDING PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <expressed_breastmilk openmrs_concept=\"1173^EXPRESSED BREASTMILK^99DCT\">false</expressed_breastmilk>\n        <weaned openmrs_concept=\"1152^WEANED^99DCT\">false</weaned>\n        <infant_formula openmrs_concept=\"5254^INFANT FORMULA^99DCT\">false</infant_formula>\n        <breastfed_predominately openmrs_concept=\"1150^BREASTFED PREDOMINATELY^99DCT\">false</breastfed_predominately>\n        <mixed_feeding openmrs_concept=\"6046^MIXED FEEDING^99DCT\">false</mixed_feeding>\n        <breastfed_exclusively openmrs_concept=\"5526^BREASTFED EXCLUSIVELY^99DCT\">false</breastfed_exclusively>\n        <cow_milk openmrs_concept=\"968^COW MILK^99DCT\">false</cow_milk>\n    </feeding_plan>\n    <child_feeding_method openmrs_concept=\"1841^CHILD FEEDING METHOD^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </child_feeding_method>\n    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\n        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\n        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\n        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\n        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\n        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\n        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\n        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\n        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\n        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\n        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\n        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\n        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\n        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\n        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\n        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\n        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\n        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\n        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\n        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\n    </referrals_ordered>\n    <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_dna_polymerase_chain_reaction_qualitative>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <polymerase_chain_reaction_date_send_to_laboratory openmrs_concept=\"2070^POLYMERASE CHAIN REACTION, DATE SEND TO LABORATORY^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </polymerase_chain_reaction_date_send_to_laboratory>\n    <return_visit_date openmrs_concept=\"1410^RETURN VISIT DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit_date>\n    <symptomatic multiple=\"0\" openmrs_concept=\"1068^SYMPTOMATIC^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </symptomatic>\n    <mother_received_counceling_for_polymerase_chain_reaction multiple=\"0\" openmrs_concept=\"2132^MOTHER RECEIVED COUNCELING FOR POLYMERASE CHAIN REACTION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </mother_received_counceling_for_polymerase_chain_reaction>\n    <date_of_delivery_the_pcr_result_to_the_family openmrs_concept=\"2133^DATE OF DELIVERY THE PCR RESULT TO THE FAMILY^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_delivery_the_pcr_result_to_the_family>\n    <polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </polymerase_chain_reaction_result_return_date>\n    <exit_from_child_at_risk_treatment multiple=\"0\" openmrs_concept=\"1873^EXIT FROM CHILD AT RISK TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </exit_from_child_at_risk_treatment>\n    <polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </polymerase_chain_reaction_date_ordered>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"6121^COTRIMOXAZOLE USE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-27 11:39:50',0,NULL,NULL,NULL,'e28ba07e-1d5f-11e0-b929-000c29ad1d07'),(82,'ATS','0.1',138,0,'MISAU:  Aconselhamento e Testagem de Saude (GATV, VTS)',14,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"ATS\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/82-0.1-138.xsn\" solutionVersion=\"0.1.0.138\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/82-138\" id=\"82\" name=\"ATS\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <ats_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(5).getIdentifier()} </ats_number>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient_address.city openmrs_attribute=\"city\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getCity()}</patient_address.city>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </organization>\n    <couples_vct_code openmrs_concept=\"1916^COUPLES VCT CODE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </couples_vct_code>\n    <partners_vct_code openmrs_concept=\"1917^PARTNERS VCT CODE^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </partners_vct_code>\n    <counseling_site_type multiple=\"0\" openmrs_concept=\"1988^COUNSELING SITE TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counseling_site_type>\n    <location_of_vct multiple=\"0\" openmrs_concept=\"1991^LOCATION OF VCT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </location_of_vct>\n    <return_visit multiple=\"0\" openmrs_concept=\"1992^RETURN VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit>\n    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </pregant>\n    <counseling_session multiple=\"0\" openmrs_concept=\"1727^COUNSELING SESSION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counseling_session>\n    <type_of_visit multiple=\"0\" openmrs_concept=\"1981^TYPE OF VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_visit>\n    <patient_paid_for_visit multiple=\"0\" openmrs_concept=\"1993^PATIENT PAID FOR VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_paid_for_visit>\n    <patient_home_location_type multiple=\"0\" openmrs_concept=\"1997^PATIENT HOME LOCATION TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_home_location_type>\n    <civil_status multiple=\"0\" openmrs_concept=\"1054^CIVIL STATUS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </civil_status>\n    <religion multiple=\"0\" openmrs_concept=\"1898^RELIGION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </religion>\n    <level_of_education multiple=\"0\" openmrs_concept=\"1443^LEVEL OF EDUCATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </level_of_education>\n    <in_school multiple=\"0\" openmrs_concept=\"1899^IN SCHOOL^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </in_school>\n    <occupation_coded multiple=\"1\" openmrs_concept=\"1914^OCCUPATION, CODED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <house_wife openmrs_concept=\"1907^HOUSE WIFE^99DCT\">false</house_wife>\n        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\n        <politician openmrs_concept=\"1911^POLITICIAN^99DCT\">false</politician>\n        <military_slash_police openmrs_concept=\"1902^MILITARY/POLICE^99DCT\">false</military_slash_police>\n        <sex_worker openmrs_concept=\"1901^SEX WORKER^99DCT\">false</sex_worker>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <student openmrs_concept=\"1900^STUDENT^99DCT\">false</student>\n        <professor openmrs_concept=\"1906^PROFESSOR^99DCT\">false</professor>\n        <house_worker openmrs_concept=\"1909^HOUSE WORKER^99DCT\">false</house_worker>\n        <subsistence_farmer openmrs_concept=\"1910^SUBSISTENCE FARMER^99DCT\">false</subsistence_farmer>\n        <health_worker openmrs_concept=\"1912^HEALTH WORKER^99DCT\">false</health_worker>\n        <security_worker openmrs_concept=\"1913^SECURITY WORKER^99DCT\">false</security_worker>\n        <vendor openmrs_concept=\"1905^VENDOR^99DCT\">false</vendor>\n        <miner openmrs_concept=\"1908^MINER^99DCT\">false</miner>\n        <driver openmrs_concept=\"1903^DRIVER^99DCT\">false</driver>\n        <migrant_worker openmrs_concept=\"1904^MIGRANT WORKER^99DCT\">false</migrant_worker>\n    </occupation_coded>\n    <currently_employed multiple=\"0\" openmrs_concept=\"1915^CURRENTLY EMPLOYED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </currently_employed>\n    <informed_of_the_need_for_hiv_testing_by multiple=\"1\" openmrs_concept=\"1931^INFORMED OF THE NEED FOR HIV TESTING BY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <family openmrs_concept=\"1927^FAMILY^99DCT\">false</family>\n        <neighbors openmrs_concept=\"1923^NEIGHBORS^99DCT\">false</neighbors>\n        <other_patients openmrs_concept=\"1928^OTHER PATIENTS^99DCT\">false</other_patients>\n        <blood_bank openmrs_concept=\"1926^BLOOD BANK^99DCT\">false</blood_bank>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <radio openmrs_concept=\"1918^RADIO^99DCT\">false</radio>\n        <health_worker openmrs_concept=\"1912^HEALTH WORKER^99DCT\">false</health_worker>\n        <television openmrs_concept=\"1919^TELEVISION^99DCT\">false</television>\n        <sexual_partner openmrs_concept=\"1921^SEXUAL PARTNER^99DCT\">false</sexual_partner>\n        <community openmrs_concept=\"1922^COMMUNITY^99DCT\">false</community>\n        <at_work openmrs_concept=\"1925^AT WORK^99DCT\">false</at_work>\n        <friend_or_colleague openmrs_concept=\"1930^FRIEND OR COLLEAGUE^99DCT\">false</friend_or_colleague>\n        <theatre_slash_dance_slash_music_group openmrs_concept=\"1929^THEATRE/DANCE/MUSIC GROUP^99DCT\">false</theatre_slash_dance_slash_music_group>\n        <pamphlet openmrs_concept=\"1920^PAMPHLET^99DCT\">false</pamphlet>\n        <school_or_church openmrs_concept=\"1924^SCHOOL OR CHURCH^99DCT\">false</school_or_church>\n    </informed_of_the_need_for_hiv_testing_by>\n    <main_reason_for_requesting_hiv_testing_and_counseling multiple=\"0\" openmrs_concept=\"1947^MAIN REASON FOR REQUESTING HIV TESTING AND COUNSELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </main_reason_for_requesting_hiv_testing_and_counseling>\n    <when_sick_do_you_go_to_a_traditional_healer multiple=\"0\" openmrs_concept=\"1950^WHEN SICK DO YOU GO TO A TRADITIONAL HEALER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </when_sick_do_you_go_to_a_traditional_healer>\n    <have_you_ever_been_vaccinated_by_a_traditional_healer multiple=\"0\" openmrs_concept=\"1951^HAVE YOU EVER BEEN VACCINATED BY A TRADITIONAL HEALER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </have_you_ever_been_vaccinated_by_a_traditional_healer>\n    <patient_has_scarification_or_tattoo multiple=\"0\" openmrs_concept=\"1952^PATIENT HAS SCARIFICATION OR TATTOO^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_has_scarification_or_tattoo>\n    <prior_hiv_test multiple=\"0\" openmrs_concept=\"1955^PRIOR HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </prior_hiv_test>\n    <reason_for_repeating_hiv_test multiple=\"1\" openmrs_concept=\"1959^REASON FOR REPEATING HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\n        <test_results_may_have_changed openmrs_concept=\"1958^TEST RESULTS MAY HAVE CHANGED^99DCT\">false</test_results_may_have_changed>\n        <patient_does_not_believe_test_results openmrs_concept=\"1956^PATIENT DOES NOT BELIEVE TEST RESULTS^99DCT\">false</patient_does_not_believe_test_results>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <in_time_period_to_retest openmrs_concept=\"1957^IN TIME PERIOD TO RETEST^99DCT\">false</in_time_period_to_retest>\n    </reason_for_repeating_hiv_test>\n    <tuberculosis_treatment_in_the_past_2_years multiple=\"0\" openmrs_concept=\"1960^TUBERCULOSIS TREATMENT IN THE PAST 2 YEARS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_in_the_past_2_years>\n    <patient_had_sexual_relations_that_included_penetration multiple=\"0\" openmrs_concept=\"1961^PATIENT HAD SEXUAL RELATIONS THAT INCLUDED PENETRATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_had_sexual_relations_that_included_penetration>\n    <parter_tested_for_hiv_in_last_3_months multiple=\"0\" openmrs_concept=\"1962^PARTER TESTED FOR HIV IN LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </parter_tested_for_hiv_in_last_3_months>\n    <patient_had_sexually_transmitted_disease_in_the_last_12_months multiple=\"0\" openmrs_concept=\"1963^PATIENT HAD SEXUALLY TRANSMITTED DISEASE IN THE LAST 12 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_had_sexually_transmitted_disease_in_the_last_12_months>\n    <number_of_sexual_partners_in_last_12_months openmrs_concept=\"1964^NUMBER OF SEXUAL PARTNERS IN LAST 12 MONTHS^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_sexual_partners_in_last_12_months>\n    <used_condom_in_last_sexual_encounter multiple=\"0\" openmrs_concept=\"1965^USED CONDOM IN LAST SEXUAL ENCOUNTER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </used_condom_in_last_sexual_encounter>\n    <last_sexual_encounter_was_with_regular_partner multiple=\"0\" openmrs_concept=\"1966^LAST SEXUAL ENCOUNTER WAS WITH REGULAR PARTNER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </last_sexual_encounter_was_with_regular_partner>\n    <how_often_did_you_use_condoms_in_the_last_3_months multiple=\"0\" openmrs_concept=\"1967^HOW OFTEN DID YOU USE CONDOMS IN THE LAST 3 MONTHS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </how_often_did_you_use_condoms_in_the_last_3_months>\n    <patient_was_tested_for_hiv_today multiple=\"0\" openmrs_concept=\"1968^PATIENT WAS TESTED FOR HIV TODAY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_was_tested_for_hiv_today>\n    <patient_received_hiv_testing_results multiple=\"0\" openmrs_concept=\"1969^PATIENT RECEIVED HIV TESTING RESULTS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_hiv_testing_results>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <symptoms_for_newly_diagnosed_hiv_patient multiple=\"1\" openmrs_concept=\"1994^SYMPTOMS FOR NEWLY DIAGNOSED HIV PATIENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <hiv_staging_-_persistent_fever openmrs_concept=\"5027^HIV STAGING - PERSISTENT FEVER^99DCT\">false</hiv_staging_-_persistent_fever>\n        <not_applicable openmrs_concept=\"1175^NOT APPLICABLE^99DCT\">false</not_applicable>\n        <weight_loss openmrs_concept=\"832^WEIGHT LOSS^99DCT\">false</weight_loss>\n        <coughing_up_blood openmrs_concept=\"1761^COUGHING UP BLOOD^99DCT\">false</coughing_up_blood>\n        <swollen_glands openmrs_concept=\"1971^SWOLLEN GLANDS^99DCT\">false</swollen_glands>\n        <cough_lasting_more_than_3_weeks openmrs_concept=\"1760^COUGH LASTING MORE THAN 3 WEEKS^99DCT\">false</cough_lasting_more_than_3_weeks>\n    </symptoms_for_newly_diagnosed_hiv_patient>\n    <the_couples_results_are_different multiple=\"0\" openmrs_concept=\"1995^THE COUPLES RESULTS ARE DIFFERENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </the_couples_results_are_different>\n    <plan_to_reduce_risk_of_hiv_exposure multiple=\"1\" openmrs_concept=\"1996^PLAN TO REDUCE RISK OF HIV EXPOSURE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <reduce_number_of_sexual_partners openmrs_concept=\"1973^REDUCE NUMBER OF SEXUAL PARTNERS^99DCT\">false</reduce_number_of_sexual_partners>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <treatment_of_sexually_transmitted_disease openmrs_concept=\"1975^TREATMENT OF SEXUALLY TRANSMITTED DISEASE^99DCT\">false</treatment_of_sexually_transmitted_disease>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <condoms openmrs_concept=\"190^CONDOMS^99DCT\">false</condoms>\n        <abstinence openmrs_concept=\"1974^ABSTINENCE^99DCT\">false</abstinence>\n        <fidelity openmrs_concept=\"1972^FIDELITY^99DCT\">false</fidelity>\n    </plan_to_reduce_risk_of_hiv_exposure>\n    <did_the_patient_take_condoms_today multiple=\"0\" openmrs_concept=\"1976^DID THE PATIENT TAKE CONDOMS TODAY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </did_the_patient_take_condoms_today>\n    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\n        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\n        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\n        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\n        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\n        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\n        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\n        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\n        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\n        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\n        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\n        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\n        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\n        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\n        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\n        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\n        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\n        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\n        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\n        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\n    </referrals_ordered>\n    <why_patient_did_not_take_hiv_test multiple=\"0\" openmrs_concept=\"2051^WHY PATIENT DID NOT TAKE HIV TEST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </why_patient_did_not_take_hiv_test>\n    <child_of_mother_hiv_counseling multiple=\"0\" openmrs_concept=\"2069^CHILD OF MOTHER HIV+, COUNSELING ^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </child_of_mother_hiv_counseling>\n    <counseling_post_delivery multiple=\"0\" openmrs_concept=\"2068^COUNSELING POST DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </counseling_post_delivery>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:17',0,NULL,NULL,NULL,'e28baa74-1d5f-11e0-b929-000c29ad1d07'),(83,'PCR','0.1',58,0,'Formulario de solicitacao do teste de PCR para ADN de HIV',22,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PCR\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/83-0.1-58.xsn\" solutionVersion=\"0.1.0.58\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/83-58\" id=\"83\" name=\"PCR\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <pcr_lab_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(10).getIdentifier()}</pcr_lab_number>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <pcr_order_number openmrs_concept=\"2042^PCR ORDER NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </pcr_order_number>\n    <name_of_mother openmrs_concept=\"1477^NAME OF MOTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </name_of_mother>\n    <entry_point_into_pcr_testing_referal_type multiple=\"1\" openmrs_concept=\"1046^ENTRY POINT INTO PCR TESTING, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <referred_from_hiv_treatment_day_hospital openmrs_concept=\"844^REFERRED FROM HIV TREATMENT (DAY HOSPITAL)^99DCT\">false</referred_from_hiv_treatment_day_hospital>\n        <referred_from_pediatric_treatment openmrs_concept=\"1044^REFERRED FROM PEDIATRIC TREATMENT^99DCT\">false</referred_from_pediatric_treatment>\n        <child_at_risk_clinic openmrs_concept=\"1872^CHILD AT RISK CLINIC^99DCT\">false</child_at_risk_clinic>\n        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n        <referred_from_prevention_of_vertical_transmission openmrs_concept=\"1939^REFERRED FROM PREVENTION OF VERTICAL TRANSMISSION^99DCT\">false</referred_from_prevention_of_vertical_transmission>\n    </entry_point_into_pcr_testing_referal_type>\n    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </infant_feeding_method>\n    <age_weaned_from_breast_feeding_months openmrs_concept=\"1510^AGE WEANED FROM BREAST FEEDING (MONTHS)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </age_weaned_from_breast_feeding_months>\n    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n    </prenatal_arv_medication_mother>\n    <ptv_treatment_child openmrs_concept=\"1970^PTV TREATMENT CHILD^99DCT\" openmrs_datatype=\"ZZ\">\n      <prevention_of_vertical_trasmission_child multiple=\"1\" openmrs_concept=\"1836^PREVENTION OF VERTICAL TRASMISSION, CHILD^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n      </prevention_of_vertical_trasmission_child>\n      <duration openmrs_concept=\"1710^DURATION^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </duration>\n    </ptv_treatment_child>\n    <polymerase_chain_reaction_test openmrs_concept=\"2001^POLYMERASE CHAIN REACTION TEST^99DCT\" openmrs_datatype=\"ZZ\">\n      <hiv_dna_polymerase_chain_reaction_qualitative multiple=\"0\" openmrs_concept=\"1030^HIV DNA POLYMERASE CHAIN REACTION, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_dna_polymerase_chain_reaction_qualitative>\n      <polymerase_chain_reaction_date_ordered openmrs_concept=\"1998^POLYMERASE CHAIN REACTION, DATE ORDERED^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </polymerase_chain_reaction_date_ordered>\n      <polymerase_chain_reaction_result_return_date openmrs_concept=\"1999^POLYMERASE CHAIN REACTION RESULT RETURN DATE^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </polymerase_chain_reaction_result_return_date>\n      <polymerase_chain_reaction_laboratory_technician openmrs_concept=\"2000^POLYMERASE CHAIN REACTION, LABORATORY TECHNICIAN^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </polymerase_chain_reaction_laboratory_technician>\n    </polymerase_chain_reaction_test>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:30',0,NULL,NULL,NULL,'e28bb654-1d5f-11e0-b929-000c29ad1d07'),(84,'STI','0.1',130,0,'MISAU: REGISTRO DIÁRIO DOS CASOS DE DTS ANTENDIDOS NAS CONSULTAS DE TRIAGEM MEDICINA E SMI - ABORDAGEM SINDRÓMICA',2,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"STI\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/84-0.1-130.xsn\" solutionVersion=\"0.1.0.130\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/84-130\" id=\"84\" name=\"STI\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <sti_number openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(7).getIdentifier()}</sti_number>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\">$!{patient.getPatientIdentifier().getLocation().getLocationId()}</encounter.location_id>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <review_of_systems_genitourinary multiple=\"1\" openmrs_concept=\"1080^REVIEW OF SYSTEMS, GENITOURINARY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <urinary_tract_infection openmrs_concept=\"55^URINARY TRACT INFECTION^99DCT\">false</urinary_tract_infection>\n        <hematuria openmrs_concept=\"840^HEMATURIA^99DCT\">false</hematuria>\n        <menstruating openmrs_concept=\"5989^MENSTRUATING^99DCT\">false</menstruating>\n        <menopausal openmrs_concept=\"5990^MENOPAUSAL^99DCT\">false</menopausal>\n        <vaginal_discharge openmrs_concept=\"5993^VAGINAL DISCHARGE^99DCT\">false</vaginal_discharge>\n        <urethral_discharge openmrs_concept=\"5995^URETHRAL DISCHARGE^99DCT\">false</urethral_discharge>\n        <dysuria openmrs_concept=\"6020^DYSURIA^99DCT\">false</dysuria>\n        <oliguria openmrs_concept=\"6021^OLIGURIA^99DCT\">false</oliguria>\n        <renal_disease openmrs_concept=\"6033^RENAL DISEASE^99DCT\">false</renal_disease>\n        <negative openmrs_concept=\"664^NEGATIVE^99DCT\">false</negative>\n        <genital_sores openmrs_concept=\"864^GENITAL SORES^99DCT\">false</genital_sores>\n    </review_of_systems_genitourinary>\n    <return_visit multiple=\"0\" openmrs_concept=\"1992^RETURN VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </return_visit>\n    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </pregant>\n    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </rapid_plasma_reagin>\n    <treatment_non-coded openmrs_concept=\"2002^TREATMENT, NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </treatment_non-coded>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:59',0,NULL,NULL,NULL,'e28bbfe6-1d5f-11e0-b929-000c29ad1d07'),(90,'BUSCA ACTIVA','0.1',38,0,'Busca Activa',21,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"BUSCA ACTIVA\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/90-0.1-38.xsn\" solutionVersion=\"0.1.0.38\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/90-38\" id=\"90\" name=\"BUSCA ACTIVA\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <activist_located_missing_patient multiple=\"0\" openmrs_concept=\"2003^ACTIVIST LOCATED MISSING PATIENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </activist_located_missing_patient>\n    <organization multiple=\"0\" openmrs_concept=\"1696^ORGANIZATION^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </organization>\n    <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </personal_reference_-_name>\n    <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </personal_reference_-_surname>\n    <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </personal_reference_-_telephone_number>\n    <date_patient_went_missing openmrs_concept=\"2004^DATE PATIENT WENT MISSING^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_patient_went_missing>\n    <pregant multiple=\"0\" openmrs_concept=\"1982^PREGANT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </pregant>\n    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_weeks_pregnant>\n    <reason_patient_missed_visit multiple=\"1\" openmrs_concept=\"2016^REASON PATIENT MISSED VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <patient_forgot_visit_date openmrs_concept=\"2005^PATIENT FORGOT VISIT DATE^99DCT\">false</patient_forgot_visit_date>\n        <patient_is_treating_hiv_with_traditional_medicine openmrs_concept=\"2013^PATIENT IS TREATING HIV WITH TRADITIONAL MEDICINE^99DCT\">false</patient_is_treating_hiv_with_traditional_medicine>\n        <patient_has_social_problems openmrs_concept=\"2009^PATIENT HAS SOCIAL PROBLEMS^99DCT\">false</patient_has_social_problems>\n        <patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false</patient_took_a_trip>\n        <distance_or_money_for_transport_is_to_much_for_patient openmrs_concept=\"2007^DISTANCE OR MONEY FOR TRANSPORT IS TO MUCH FOR PATIENT^99DCT\">false</distance_or_money_for_transport_is_to_much_for_patient>\n        <patients_work_prevents_clinic_visit openmrs_concept=\"2014^PATIENTS WORK PREVENTS CLINIC VISIT^99DCT\">false</patients_work_prevents_clinic_visit>\n        <patient_has_lack_of_motivation openmrs_concept=\"2012^PATIENT HAS LACK OF MOTIVATION^99DCT\">false</patient_has_lack_of_motivation>\n        <patient_has_lack_of_food openmrs_concept=\"2008^PATIENT HAS LACK OF FOOD^99DCT\">false</patient_has_lack_of_food>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <patient_is_dissatisfied_with_day_hospital_services openmrs_concept=\"2010^PATIENT IS DISSATISFIED WITH DAY HOSPITAL SERVICES^99DCT\">false</patient_is_dissatisfied_with_day_hospital_services>\n        <patient_does_not_like_arv_treatment_side_effects openmrs_concept=\"2015^PATIENT DOES NOT LIKE ARV TREATMENT SIDE EFFECTS^99DCT\">false</patient_does_not_like_arv_treatment_side_effects>\n        <patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false</patient_is_bedridden_at_home>\n        <other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\">false</other_reason_why_patient_missed_visit>\n    </reason_patient_missed_visit>\n    <other_reason_why_patient_missed_visit openmrs_concept=\"2017^OTHER REASON WHY PATIENT MISSED VISIT ^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_reason_why_patient_missed_visit>\n    <arrangements_required_for_patient_to_visit_hospital multiple=\"1\" openmrs_concept=\"2022^ARRANGEMENTS REQUIRED FOR PATIENT TO VISIT HOSPITAL^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <patient_will_borrow_money openmrs_concept=\"2021^PATIENT WILL BORROW MONEY^99DCT\">false</patient_will_borrow_money>\n        <patient_will_leave_children_with_somebody openmrs_concept=\"2019^PATIENT WILL LEAVE CHILDREN WITH SOMEBODY^99DCT\">false</patient_will_leave_children_with_somebody>\n        <patient_will_get_a_ride openmrs_concept=\"2018^PATIENT WILL GET A RIDE^99DCT\">false</patient_will_get_a_ride>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <patient_will_get_authorization_from_work openmrs_concept=\"2020^PATIENT WILL GET AUTHORIZATION FROM WORK^99DCT\">false</patient_will_get_authorization_from_work>\n        <patient_is_bedridden_at_home openmrs_concept=\"2006^PATIENT IS BEDRIDDEN AT HOME^99DCT\">false</patient_is_bedridden_at_home>\n    </arrangements_required_for_patient_to_visit_hospital>\n    <other_arrangements_for_patient_to_get_to_hospital openmrs_concept=\"2023^OTHER ARRANGEMENTS FOR PATIENT TO GET TO HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_arrangements_for_patient_to_get_to_hospital>\n    <reason_patient_not_found_by_activist multiple=\"1\" openmrs_concept=\"2031^REASON PATIENT NOT FOUND BY ACTIVIST^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <patient_record_has_wrong_address openmrs_concept=\"2024^PATIENT RECORD HAS WRONG ADDRESS^99DCT\">false</patient_record_has_wrong_address>\n        <transferred_out_to_another_facility openmrs_concept=\"1706^TRANSFERRED OUT TO ANOTHER FACILITY^99DCT\">false</transferred_out_to_another_facility>\n        <patient_was_admitted_at_hospital openmrs_concept=\"2028^PATIENT WAS ADMITTED AT HOSPITAL^99DCT\">false</patient_was_admitted_at_hospital>\n        <patient_took_a_trip openmrs_concept=\"2011^PATIENT TOOK A TRIP^99DCT\">false</patient_took_a_trip>\n        <patient_moved_houses openmrs_concept=\"2026^PATIENT MOVED HOUSES^99DCT\">false</patient_moved_houses>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <patient_is_dead openmrs_concept=\"2027^PATIENT IS DEAD^99DCT\">false</patient_is_dead>\n        <patient_was_working_on_their_farm openmrs_concept=\"2029^PATIENT WAS WORKING ON THEIR FARM^99DCT\">false</patient_was_working_on_their_farm>\n        <nobody_answered_at_patients_home openmrs_concept=\"2025^NOBODY ANSWERED AT PATIENTS HOME^99DCT\">false</nobody_answered_at_patients_home>\n        <patient_was_at_work openmrs_concept=\"2030^PATIENT WAS AT WORK^99DCT\">false</patient_was_at_work>\n        <other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\">false</other_reasons_why_patient_was_not_located_by_activist>\n    </reason_patient_not_found_by_activist>\n    <other_reasons_why_patient_was_not_located_by_activist openmrs_concept=\"2032^OTHER REASONS WHY PATIENT WAS NOT LOCATED BY ACTIVIST^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_reasons_why_patient_was_not_located_by_activist>\n    <reason_patient_not_found_provided_by multiple=\"1\" openmrs_concept=\"2037^REASON PATIENT NOT FOUND PROVIDED BY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <chief_of_neighborhood_provided_reason_patient_was_not_located openmrs_concept=\"2036^CHIEF OF NEIGHBORHOOD PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</chief_of_neighborhood_provided_reason_patient_was_not_located>\n        <neighbor_provided_reason_patient_was_not_located openmrs_concept=\"2034^NEIGHBOR PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</neighbor_provided_reason_patient_was_not_located>\n        <relative_provided_reason_patient_was_not_located openmrs_concept=\"2035^RELATIVE PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</relative_provided_reason_patient_was_not_located>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <confidant_provided_reason_patient_was_not_located openmrs_concept=\"2033^CONFIDANT PROVIDED REASON PATIENT WAS NOT LOCATED^99DCT\">false</confidant_provided_reason_patient_was_not_located>\n    </reason_patient_not_found_provided_by>\n    <who_provided_reason_patient_not_found_other openmrs_concept=\"2038^WHO PROVIDED REASON PATIENT NOT FOUND, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </who_provided_reason_patient_not_found_other>\n    <referrals_ordered multiple=\"1\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <social_support_services openmrs_concept=\"5486^SOCIAL SUPPORT SERVICES^99DCT\">false</social_support_services>\n        <tuberculosis_treatment_or_dot_program openmrs_concept=\"5487^TUBERCULOSIS TREATMENT OR DOT PROGRAM^99DCT\">false</tuberculosis_treatment_or_dot_program>\n        <disclosure_counseling openmrs_concept=\"1167^DISCLOSURE COUNSELING^99DCT\">false</disclosure_counseling>\n        <nutritional_support openmrs_concept=\"5484^NUTRITIONAL SUPPORT^99DCT\">false</nutritional_support>\n        <adherence_counseling openmrs_concept=\"5488^ADHERENCE COUNSELING^99DCT\">false</adherence_counseling>\n        <mental_health_services openmrs_concept=\"5489^MENTAL HEALTH SERVICES^99DCT\">false</mental_health_services>\n        <psychosocial_counseling openmrs_concept=\"5490^PSYCHOSOCIAL COUNSELING^99DCT\">false</psychosocial_counseling>\n        <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\">false</other_non-coded>\n        <family_planning_services openmrs_concept=\"5483^FAMILY PLANNING SERVICES^99DCT\">false</family_planning_services>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <alcohol_counseling openmrs_concept=\"1288^ALCOHOL COUNSELING^99DCT\">false</alcohol_counseling>\n        <inpatient_care_or_hospitalization openmrs_concept=\"5485^INPATIENT CARE OR HOSPITALIZATION^99DCT\">false</inpatient_care_or_hospitalization>\n        <home_based_care openmrs_concept=\"1699^HOME BASED CARE^99DCT\">false</home_based_care>\n        <plano_nacional_para_combate_tuberculose openmrs_concept=\"1414^PLANO NACIONAL PARA COMBATE TUBERCULOSE^99DCT\">false</plano_nacional_para_combate_tuberculose>\n        <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\">false</day_hospital>\n        <medical_consultation openmrs_concept=\"1798^MEDICAL CONSULTATION^99DCT\">false</medical_consultation>\n        <triage openmrs_concept=\"1887^TRIAGE^99DCT\">false</triage>\n        <pre-natal_consultation openmrs_concept=\"1978^PRE-NATAL CONSULTATION^99DCT\">false</pre-natal_consultation>\n        <association_of_people_with_hiv openmrs_concept=\"1977^ASSOCIATION OF PEOPLE WITH HIV^99DCT\">false</association_of_people_with_hiv>\n        <sexually_transmitted_disease_consultation openmrs_concept=\"1979^SEXUALLY TRANSMITTED DISEASE  CONSULTATION^99DCT\">false</sexually_transmitted_disease_consultation>\n        <domestic_visit openmrs_concept=\"2039^DOMESTIC VISIT^99DCT\">false</domestic_visit>\n        <voluntary_counceling_and_testing openmrs_concept=\"1597^VOLUNTARY COUNCELING AND TESTING^99DCT\">false</voluntary_counceling_and_testing>\n        <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\">false</referral_other>\n        <family_was_referred_to_the_health_unit openmrs_concept=\"2159^FAMILY WAS REFERRED TO THE HEALTH UNIT^99DCT\">false</family_was_referred_to_the_health_unit>\n    </referrals_ordered>\n    <referral_other openmrs_concept=\"2040^REFERRAL, OTHER^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referral_other>\n    <activists_observations openmrs_concept=\"2041^ACTIVISTS OBSERVATIONS^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </activists_observations>\n    <on_arv_treatment multiple=\"0\" openmrs_concept=\"2052^ON ARV TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </on_arv_treatment>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',9,'2008-12-10 14:53:51',13,'2011-01-11 15:23:20',0,NULL,NULL,NULL,'e28fa7dc-1d5f-11e0-b929-000c29ad1d07'),(91,'TARV: ACONSELHAMENTO SEGUIMENTO','0.1',45,0,'Seguimento de Aconselhamento TARV',24,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/91-0.1-45.xsn\" solutionVersion=\"0.1.0.45\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/91-45\" id=\"91\" name=\"TARV: ACONSELHAMENTO SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier().getIdentifier()}</nid>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <other_masses_description openmrs_concept=\"1553^OTHER MASSES, DESCRIPTION^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_masses_description>\n    <attendance_type multiple=\"0\" openmrs_concept=\"2047^ATTENDANCE TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </attendance_type>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:03',0,NULL,NULL,NULL,'e28fae8a-1d5f-11e0-b929-000c29ad1d07');
    INSERT INTO `form` VALUES (92,'TUBERCULOSE: PROCESSO','0.1',69,0,'FICHA INDIVIDUAL DE TRATAMENTO DE TUBERCULOSE',26,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/92-0.1-69.xsn\" solutionVersion=\"0.1.0.69\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/92-69\" id=\"92\" name=\"TUBERCULOSE: PROCESSO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_plan>\n    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_drug_treatment_start_date>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment>\n    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_tuberculosis>\n    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tubuculosis_exams>\n      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sputum_for_acid_fast_bacilli>\n      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </x-ray_chest>\n      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ultrasound_tb>\n      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymph_node_biopsy>\n      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </paracentesis>\n      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </thoracentesis>\n      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </purified_protein_derivative>\n      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gastric_levage>\n      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </test_other>\n      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </bailey_months>\n      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </weight_kg>\n      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_layers>\n    </tuberculosis_exams_set>\n    <date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_administration_of_medication_for_tb_intensive_phase>\n    <patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_reported_current_tuberculosis_treatment>\n    <date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_tb_administration_of_medication_maintenance_phase>\n    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transfer_from_other_facility_facility_name>\n      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transferred_out_to_another_facility_facility_name>\n    </transfer_facility_names>\n    <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </entry_point_into_hiv_care_referal_type>\n    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hospital_slash_clinic>\n    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_name>\n      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_surname>\n      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_telephone_number>\n      <personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_address>\n    </personal_reference>\n    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_patient_hiv_positive>\n    <cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\n    </cotrimoxazole_use>\n    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </day_hospital>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_tuberculosis_treatment_stopped>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:20',0,NULL,NULL,NULL,'e28fb36c-1d5f-11e0-b929-000c29ad1d07'),(93,'PTV-CPN: PROCESSO','0.1',52,0,'Processo de PTV - CPN, Adaptado do LIVRO OFICIAL DA PTV - CPN',11,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: PROCESSO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/93-0.1-52.xsn\" solutionVersion=\"0.1.0.52\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/93-52\" id=\"93\" name=\"PTV-CPN: PROCESSO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}</ptv-cpn_codigo>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant>\n      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_visit_number>\n    </visit_number_and_weeks_pregnant_ptv>\n    <first_pregnant multiple=\"0\" openmrs_concept=\"2073^FIRST PREGNANT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </first_pregnant>\n    <estimated_date_of_confinement openmrs_concept=\"5596^ESTIMATED DATE OF CONFINEMENT^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </estimated_date_of_confinement>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <planned_date_to_administer_nvp_during_pregnancy openmrs_concept=\"1802^PLANNED DATE TO ADMINISTER NVP DURING PREGNANCY^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </planned_date_to_administer_nvp_during_pregnancy>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:45',0,NULL,NULL,NULL,'e28fbefc-1d5f-11e0-b929-000c29ad1d07'),(94,'TUBERCULOSE: SEGUIMENTO','0.1',74,0,'FICHA DE SEGUIMENTO DE DOENTES COM TUBERCULOSE',27,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/94-0.1-74.xsn\" solutionVersion=\"0.1.0.74\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/94-74\" id=\"94\" name=\"TUBERCULOSE: SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_plan>\n    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_drug_treatment_start_date>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_tuberculosis>\n    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tubuculosis_exams>\n      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sputum_for_acid_fast_bacilli>\n      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </x-ray_chest>\n      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ultrasound_tb>\n      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymph_node_biopsy>\n      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </paracentesis>\n      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </thoracentesis>\n      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </purified_protein_derivative>\n      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gastric_levage>\n      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </test_other>\n      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </bailey_months>\n      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </weight_kg>\n      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_layers>\n    </tuberculosis_exams_set>\n    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hospital_slash_clinic>\n    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </day_hospital>\n    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transfer_from_other_facility_facility_name>\n      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transferred_out_to_another_facility_facility_name>\n    </transfer_facility_names>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_tuberculosis_treatment_stopped>\n    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n    </tuberculosis_prophylaxis_started>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </medication_quantity_available>\n    <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_children>\n    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:22',0,NULL,NULL,NULL,'e28fcb2c-1d5f-11e0-b929-000c29ad1d07'),(95,'PTV-CPN: SEGUIMENTO - PILOTO','0.1',77,0,'FICHA DE SEGUIMENTO DE PTV na CPN',12,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/95-0.1-77.xsn\" solutionVersion=\"0.1.0.77\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/95-77\" id=\"95\" name=\"PTV-CPN: SEGUIMENTO - PILOTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}</codigo_ptv_cpn>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid_servico_tarv>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant>\n      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_visit_number>\n    </visit_number_and_weeks_pregnant_ptv>\n    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_counceling>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </accepts_home_visit>\n    <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </fansidar_dose>\n    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </rapid_plasma_reagin>\n    <malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </malarial_smear>\n    <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hemoglobin>\n    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cd4_count>\n    <patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_cd4_results>\n    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_who_hiv_stage>\n    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n    </prenatal_arv_medication_mother>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </entry_point_into_hiv_care_patient_code_at_location>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </result_of_hiv_test_of_partner>\n    <partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </partner_received_counceling>\n    <antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false</unknown_antiretroviral_drug>\n        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\n        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\n        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\n        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\n        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\n        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\n        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\n        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\n    </antiretroviral_drugs>\n    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </medication_quantity_available>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:50',0,NULL,NULL,NULL,'e28ff412-1d5f-11e0-b929-000c29ad1d07'),(96,'PTV: MATERNIDADE - PILOTO','0.1',63,0,'Livro: Programa de Prevenção de Transmissão Vertical para Maternidade',23,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV: MATERNIDADE - PILOTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/96-0.1-63.xsn\" solutionVersion=\"0.1.0.63\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/96-63\" id=\"96\" name=\"PTV: MATERNIDADE - PILOTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <ptv_maternity_code openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(8).getIdentifier()}</ptv_maternity_code>\n    <ptv-cpn_codigo openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(6).getIdentifier()}</ptv-cpn_codigo>\n    <nid openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <hour_mother_entered_hospital_to_give_birth openmrs_concept=\"1828^HOUR MOTHER ENTERED HOSPITAL TO GIVE BIRTH^99DCT\" openmrs_datatype=\"TM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hour_mother_entered_hospital_to_give_birth>\n    <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_weeks_pregnant>\n    <dilation_on_entering_hospital openmrs_concept=\"1813^DILATION ON ENTERING HOSPITAL ^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </dilation_on_entering_hospital>\n    <administration_of_arv_during_delivery openmrs_concept=\"1824^ADMINISTRATION OF ARV DURING DELIVERY^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n            <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n            <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n            <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n            <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n            <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n            <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n            <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n            <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n            <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n      </prenatal_arv_medication_mother>\n      <nevirapine_administered_at_home multiple=\"0\" openmrs_concept=\"1814^NEVIRAPINE ADMINISTERED AT HOME^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </nevirapine_administered_at_home>\n      <hour_nvp_taken_in_maternity openmrs_concept=\"1829^HOUR NVP TAKEN IN MATERNITY^99DCT\" openmrs_datatype=\"TS\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hour_nvp_taken_in_maternity>\n      <patient_vomited_within_an_hour_of_taking_nevirapine multiple=\"0\" openmrs_concept=\"1815^PATIENT VOMITED WITHIN AN HOUR OF TAKING NEVIRAPINE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_vomited_within_an_hour_of_taking_nevirapine>\n      <administration_of_azt_during_pregnacy multiple=\"0\" openmrs_concept=\"2087^ADMINISTRATION OF AZT DURING PREGNACY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </administration_of_azt_during_pregnacy>\n      <patient_took_nevirapine_in_maternity multiple=\"0\" openmrs_concept=\"1816^PATIENT TOOK NEVIRAPINE IN MATERNITY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_took_nevirapine_in_maternity>\n      <azt_during_delivery multiple=\"1\" openmrs_concept=\"2088^AZT DURING DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false</three_doses>\n            <one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false</one_dose>\n            <four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false</four_doses>\n            <two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false</two_doses>\n      </azt_during_delivery>\n      <azt_slash_3tc_for_mother multiple=\"1\" openmrs_concept=\"2089^AZT/3TC FOR MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <three_doses openmrs_concept=\"2084^THREE DOSES^99DCT\">false</three_doses>\n            <one_dose openmrs_concept=\"1182^ONE DOSE^99DCT\">false</one_dose>\n            <four_doses openmrs_concept=\"2085^FOUR DOSES^99DCT\">false</four_doses>\n            <two_doses openmrs_concept=\"1183^TWO DOSES^99DCT\">false</two_doses>\n      </azt_slash_3tc_for_mother>\n    </administration_of_arv_during_delivery>\n    <infant_feeding_method multiple=\"0\" openmrs_concept=\"1151^INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </infant_feeding_method>\n    <received_counceling_for_infant_feeding_method multiple=\"0\" openmrs_concept=\"2086^RECEIVED COUNCELING FOR INFANT FEEDING METHOD^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </received_counceling_for_infant_feeding_method>\n    <time_of_birth openmrs_concept=\"1830^DATE AND TIME NVP TAKEN AT HOME^99DCT\" openmrs_datatype=\"TS\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </time_of_birth>\n    <location_of_delivery multiple=\"0\" openmrs_concept=\"1581^LOCATION OF DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </location_of_delivery>\n    <birth_weight_kg openmrs_concept=\"5916^BIRTH WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </birth_weight_kg>\n    <stillborn multiple=\"0\" openmrs_concept=\"1819^STILLBORN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </stillborn>\n    <prophylaxis_administered_to_newborn openmrs_concept=\"1825^PROPHYLAXIS ADMINISTERED TO NEWBORN^99DCT\" openmrs_datatype=\"ZZ\">\n      <first_dose_of_nevirapine_given_to_child_at_birth multiple=\"0\" openmrs_concept=\"1821^FIRST DOSE OF NEVIRAPINE GIVEN TO CHILD AT BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </first_dose_of_nevirapine_given_to_child_at_birth>\n      <_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth multiple=\"0\" openmrs_concept=\"1822^2ND DOSE OF NEVIRAPINE GIVEN TO CHILD 48 TO 72 HOURS AFER BIRTH^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </_2nd_dose_of_nevirapine_given_to_child_48_to_72_hours_afer_birth>\n      <mother_took_azt_syrup_home multiple=\"0\" openmrs_concept=\"1823^MOTHER TOOK AZT SYRUP HOME^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </mother_took_azt_syrup_home>\n    </prophylaxis_administered_to_newborn>\n    <ptv_hiv_result_set openmrs_concept=\"2090^PTV HIV RESULT, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <patient_was_tested_for_hiv_in_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2078^PATIENT WAS TESTED FOR HIV IN PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_was_tested_for_hiv_in_pre_natal_consultation>\n      <hiv_result_for_test_taken_on_pre_natal_consultation multiple=\"0\" openmrs_concept=\"2079^HIV RESULT FOR TEST TAKEN ON PRE NATAL CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_result_for_test_taken_on_pre_natal_consultation>\n      <patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago multiple=\"0\" openmrs_concept=\"2080^PATIENT WAS TESTED ON PRE-NATAL CONSULTATION MORE THAN 3 MONTHS AGO^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </patient_was_tested_on_pre-natal_consultation_more_than_3_months_ago>\n      <received_counceling_and_tested_on_maternity_before_delivery multiple=\"0\" openmrs_concept=\"2081^RECEIVED COUNCELING AND TESTED ON MATERNITY BEFORE DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </received_counceling_and_tested_on_maternity_before_delivery>\n      <received_counceling_and_tested_on_maternity_after_delivery multiple=\"0\" openmrs_concept=\"2082^RECEIVED COUNCELING AND TESTED ON MATERNITY AFTER DELIVERY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </received_counceling_and_tested_on_maternity_after_delivery>\n      <hiv_result_for_test_taken_on_maternity_consultation multiple=\"0\" openmrs_concept=\"2083^HIV RESULT FOR TEST TAKEN ON MATERNITY CONSULTATION^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </hiv_result_for_test_taken_on_maternity_consultation>\n    </ptv_hiv_result_set>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:55',0,NULL,NULL,NULL,'e28ff908-1d5f-11e0-b929-000c29ad1d07'),(97,'PTV-CPN: SEGUIMENTO','0.1',79,0,'FICHA DE SEGUIMENTO DE PTV na CPN',12,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"PTV-CPN: SEGUIMENTO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/97-0.1-79.xsn\" solutionVersion=\"0.1.0.79\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/97-79\" id=\"97\" name=\"PTV-CPN: SEGUIMENTO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <codigo_ptv_cpn openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(6).getIdentifier()}</codigo_ptv_cpn>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <nid_servico_tarv openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(2).getIdentifier()}</nid_servico_tarv>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <visit_number_and_weeks_pregnant_ptv openmrs_concept=\"2062^VISIT NUMBER AND WEEKS PREGNANT PTV^99DCT\" openmrs_datatype=\"ZZ\">\n      <number_of_weeks_pregnant openmrs_concept=\"1279^NUMBER OF WEEKS PREGNANT^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant>\n      <prenatal_visit_number openmrs_concept=\"1804^PRENATAL VISIT NUMBER^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_visit_number>\n    </visit_number_and_weeks_pregnant_ptv>\n    <patient_received_counceling multiple=\"0\" openmrs_concept=\"1463^PATIENT RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_counceling>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <accepts_home_visit multiple=\"0\" openmrs_concept=\"2071^ACCEPTS HOME VISIT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </accepts_home_visit>\n    <fansidar_dose openmrs_concept=\"1807^FANSIDAR DOSE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </fansidar_dose>\n    <rapid_plasma_reagin multiple=\"0\" openmrs_concept=\"1655^RAPID PLASMA REAGIN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </rapid_plasma_reagin>\n    <malarial_smear multiple=\"0\" openmrs_concept=\"32^MALARIAL SMEAR^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </malarial_smear>\n    <hemoglobin openmrs_concept=\"21^HEMOGLOBIN^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hemoglobin>\n    <cd4_count openmrs_concept=\"5497^CD4 COUNT^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cd4_count>\n    <patient_received_cd4_results multiple=\"0\" openmrs_concept=\"2072^PATIENT RECEIVED CD4 RESULTS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_received_cd4_results>\n    <current_who_hiv_stage multiple=\"0\" openmrs_concept=\"5356^CURRENT WHO HIV STAGE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </current_who_hiv_stage>\n    <prenatal_arv_medication_mother multiple=\"1\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <sulfadoxine_and_pyrimethamine openmrs_concept=\"87^SULFADOXINE AND PYRIMETHAMINE^99DCT\">false</sulfadoxine_and_pyrimethamine>\n        <tarv_treatment openmrs_concept=\"1800^TARV TREATMENT^99DCT\">false</tarv_treatment>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <zidovudine_nevirapine openmrs_concept=\"1801^ZIDOVUDINE + NEVIRAPINE^99DCT\">false</zidovudine_nevirapine>\n        <none openmrs_concept=\"1107^NONE^99DCT\">false</none>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n    </prenatal_arv_medication_mother>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <entry_point_into_hiv_care_patient_code_at_location openmrs_concept=\"1627^ENTRY POINT INTO HIV CARE, PATIENT CODE AT LOCATION^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </entry_point_into_hiv_care_patient_code_at_location>\n    <referrals_ordered multiple=\"0\" openmrs_concept=\"1272^REFERRALS ORDERED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </referrals_ordered>\n    <cotrimoxazole_use multiple=\"0\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </cotrimoxazole_use>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <result_of_hiv_test_of_partner multiple=\"0\" openmrs_concept=\"2074^RESULT OF HIV TEST OF PARTNER^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </result_of_hiv_test_of_partner>\n    <partner_received_counceling multiple=\"0\" openmrs_concept=\"2075^PARTNER RECEIVED COUNCELING^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </partner_received_counceling>\n    <antiretroviral_drugs multiple=\"1\" openmrs_concept=\"1085^ANTIRETROVIRAL DRUGS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <unknown_antiretroviral_drug openmrs_concept=\"5811^UNKNOWN ANTIRETROVIRAL DRUG^99DCT\">false</unknown_antiretroviral_drug>\n        <abacavir_lamivudine_zidovudine openmrs_concept=\"817^ABACAVIR + LAMIVUDINE + ZIDOVUDINE^99DCT\">false</abacavir_lamivudine_zidovudine>\n        <other_antiretroviral_drug openmrs_concept=\"5424^OTHER ANTIRETROVIRAL DRUG^99DCT\">false</other_antiretroviral_drug>\n        <didanosine openmrs_concept=\"796^DIDANOSINE^99DCT\">false</didanosine>\n        <zidovudine_and_lamivudine openmrs_concept=\"630^ZIDOVUDINE AND LAMIVUDINE^99DCT\">false</zidovudine_and_lamivudine>\n        <indinavir openmrs_concept=\"749^INDINAVIR^99DCT\">false</indinavir>\n        <ritonavir openmrs_concept=\"795^RITONAVIR^99DCT\">false</ritonavir>\n        <abacavir openmrs_concept=\"814^ABACAVIR^99DCT\">false</abacavir>\n        <stavudine openmrs_concept=\"625^STAVUDINE^99DCT\">false</stavudine>\n        <zidovudine openmrs_concept=\"797^ZIDOVUDINE^99DCT\">false</zidovudine>\n        <efavirenz openmrs_concept=\"633^EFAVIRENZ^99DCT\">false</efavirenz>\n        <lamivudine openmrs_concept=\"628^LAMIVUDINE^99DCT\">false</lamivudine>\n        <nevirapine openmrs_concept=\"631^NEVIRAPINE^99DCT\">false</nevirapine>\n        <nelfinavir openmrs_concept=\"635^NELFINAVIR^99DCT\">false</nelfinavir>\n        <stavudine_lamivudine_nevirapine openmrs_concept=\"792^STAVUDINE + LAMIVUDINE + NEVIRAPINE^99DCT\">false</stavudine_lamivudine_nevirapine>\n        <stavudine_lamivudine openmrs_concept=\"1579^STAVUDINE + LAMIVUDINE^99DCT\">false</stavudine_lamivudine>\n        <ziduvadinedidanosinenelfinavir openmrs_concept=\"1700^ZIDUVADINE+DIDANOSINE+NELFINAVIR^99DCT\">false</ziduvadinedidanosinenelfinavir>\n        <abacavir_didanosine_nelfinavir openmrs_concept=\"1701^ABACAVIR + DIDANOSINE + NELFINAVIR^99DCT\">false</abacavir_didanosine_nelfinavir>\n    </antiretroviral_drugs>\n    <medication_quantity_available openmrs_concept=\"1715^MEDICATION QUANTITY AVAILABLE^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </medication_quantity_available>\n    <azt_profalaxis_for_prevention_of_vertical_transmission openmrs_concept=\"1803^AZT PROFALAXIS FOR PREVENTION OF VERTICAL TRANSMISSION^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother>\n      <number_of_weeks_pregnant_when_starting_azt_profolaxis openmrs_concept=\"1808^NUMBER OF WEEKS PREGNANT WHEN STARTING AZT PROFOLAXIS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_when_starting_azt_profolaxis>\n      <date_of_prophylaxis_with_azt_azt_nvp_intrapartum openmrs_concept=\"2091^DATE OF PROPHYLAXIS WITH AZT (AZT + NVP INTRAPARTUM)^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_prophylaxis_with_azt_azt_nvp_intrapartum>\n    </azt_profalaxis_for_prevention_of_vertical_transmission>\n    <nevirapine_administered_during_prenatal_consultations openmrs_concept=\"1806^NEVIRAPINE ADMINISTERED DURING PRENATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n      <prenatal_arv_medication_mother multiple=\"0\" openmrs_concept=\"1504^PRENATAL ARV MEDICATION, MOTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </prenatal_arv_medication_mother>\n      <number_of_weeks_pregnant_when_starting_nevirapine openmrs_concept=\"1812^NUMBER OF WEEKS PREGNANT WHEN STARTING NEVIRAPINE^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_weeks_pregnant_when_starting_nevirapine>\n      <date_of_delivery_niverapine_at_pre-natal_consultations openmrs_concept=\"2092^DATE OF DELIVERY NIVERAPINE AT PRE-NATAL CONSULTATIONS^99DCT\" openmrs_datatype=\"DT\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </date_of_delivery_niverapine_at_pre-natal_consultations>\n    </nevirapine_administered_during_prenatal_consultations>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:23:48',0,NULL,NULL,NULL,'e28ffd86-1d5f-11e0-b929-000c29ad1d07'),(98,'TUBERCULOSE: LIVRO','0.1',71,0,'Livro de Registo de doentes com Tuberculose',25,'<?xml version=\"1.0\" encoding=\"UTF-8\"?><?mso-infoPathSolution name=\"TUBERCULOSE: LIVRO\" href=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/98-0.1-71.xsn\" solutionVersion=\"0.1.0.71\" productVersion=\"11.0.6357\" PIVersion=\"1.0.0.0\" ?><?mso-application progid=\"InfoPath.Document\"?><form xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:xd=\"http://schemas.microsoft.com/office/infopath/2003\" xmlns:openmrs=\"http://10.10.1.11:8080/openmrs/moduleServlet/formentry/forms/schema/98-71\" id=\"98\" name=\"TUBERCULOSE: LIVRO\" version=\"0.1\">\n  <header>\n    <enterer>$!{enterer}</enterer>\n    <date_entered>$!{dateEntered}</date_entered>\n    <session>$!{sessionId}</session>\n    <uid>$!{uid}</uid>\n  </header>\n  <patient>\n    <patient.patient_id openmrs_attribute=\"patient_id\" openmrs_table=\"patient\">$!{patient.getPatientId()}</patient.patient_id>\n    <nit openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(11).getIdentifier()}</nit>\n    <patient_identify.bi openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(3).getIdentifier()}</patient_identify.bi>\n    <patient.local_trabalho openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(11).getValue()}</patient.local_trabalho>\n    <patient_identify.other openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient_identify.other>\n    <patient_attribute.cellphone openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAttribute(9).getValue()}</patient_attribute.cellphone>\n    <patient.age openmrs_attribute=\"\" openmrs_table=\"\">$!{patient.getAge()}</patient.age>\n    <patient.birthdate openmrs_attribute=\"birthdate\" openmrs_table=\"patient\">$!{date.format($patient.getBirthdate())}</patient.birthdate>\n    <patient.birthdate_estimated openmrs_attribute=\"birthdate_estimated\" openmrs_table=\"patient\">$!{patient.getBirthDateEstimated()}</patient.birthdate_estimated>\n    <patient.family_name openmrs_attribute=\"family_name\" openmrs_table=\"patient_name\">$!{patient.getFamilyName()}</patient.family_name>\n    <patient.given_name openmrs_attribute=\"given_name\" openmrs_table=\"patient_name\">$!{patient.getGivenName()}</patient.given_name>\n    <patient.medical_record_number openmrs_attribute=\"identifier\" openmrs_table=\"patient_identifier\">$!{patient.getPatientIdentifier(1).getIdentifier()}</patient.medical_record_number>\n    <patient.middle_name openmrs_attribute=\"middle_name\" openmrs_table=\"patient_name\">$!{patient.getMiddleName()}</patient.middle_name>\n    <patient.sex openmrs_attribute=\"gender\" openmrs_table=\"patient\">$!{patient.getGender()}</patient.sex>\n    <patient_address.address1 openmrs_attribute=\"address1\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress1()}</patient_address.address1>\n    <casa openmrs_attribute=\"address2\" openmrs_table=\"patient_address\">$!{patient.getPersonAddress().getAddress2()}</casa>\n    <localidade openmrs_attribute=\"region\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getRegion()}</localidade>\n    <celula_quarteirao openmrs_attribute=\"neighborhood_cell\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getNeighborhoodCell()}</celula_quarteirao>\n    <distrito openmrs_attribute=\"county_district\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountyDistrict()}</distrito>\n    <bairro openmrs_attribute=\"subregion\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getSubregion()}</bairro>\n    <provincia openmrs_attribute=\"state_province\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getStateProvince()}</provincia>\n    <patient_address.city_village openmrs_attribute=\"city_village\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCityVillage()}</patient_address.city_village>\n    <patient_address.postal_code openmrs_attribute=\"postal_code\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getPostalCode()}</patient_address.postal_code>\n    <patient_address.country openmrs_attribute=\"country\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getCountry()}</patient_address.country>\n    <patient_address.latitude openmrs_attribute=\"latitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLatitude()}</patient_address.latitude>\n    <patient_address.longitude openmrs_attribute=\"longitude\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getLongitude()}</patient_address.longitude>\n    <patient_address.township_division openmrs_attribute=\"township_division\" openmrs_table=\"person_address\">$!{patient.getPersonAddress().getTownshipDivision()}</patient_address.township_division>\n  </patient>\n  <encounter>\n    <encounter.encounter_datetime openmrs_attribute=\"encounter_datetime\" openmrs_table=\"encounter\"/>\n    <encounter.location_id openmrs_attribute=\"location_id\" openmrs_table=\"encounter\"/>\n    <encounter.provider_id openmrs_attribute=\"provider_id\" openmrs_table=\"encounter\"/>\n  </encounter>\n  <obs openmrs_concept=\"1238^MEDICAL RECORD OBSERVATIONS^99DCT\" openmrs_datatype=\"ZZ\">\n    <tuberculosis_treatment_plan multiple=\"0\" openmrs_concept=\"1268^TUBERCULOSIS TREATMENT PLAN^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment_plan>\n    <tuberculosis_drug_treatment_start_date openmrs_concept=\"1113^TUBERCULOSIS DRUG TREATMENT START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_drug_treatment_start_date>\n    <other_non-coded openmrs_concept=\"5622^OTHER NON-CODED^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </other_non-coded>\n    <tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1270^TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </tuberculosis_treatment>\n    <type_of_tuberculosis multiple=\"0\" openmrs_concept=\"1784^TYPE OF TUBERCULOSIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </type_of_tuberculosis>\n    <tuberculosis_exams_set openmrs_concept=\"1787^TUBERCULOSIS EXAMS, SET^99DCT\" openmrs_datatype=\"ZZ\">\n      <tubuculosis_exams multiple=\"0\" openmrs_concept=\"1775^TUBUCULOSIS EXAMS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </tubuculosis_exams>\n      <sputum_for_acid_fast_bacilli multiple=\"0\" openmrs_concept=\"307^SPUTUM FOR ACID FAST BACILLI^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </sputum_for_acid_fast_bacilli>\n      <x-ray_chest multiple=\"0\" openmrs_concept=\"12^X-RAY, CHEST^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </x-ray_chest>\n      <ultrasound_tb multiple=\"0\" openmrs_concept=\"1768^ULTRASOUND, TB^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </ultrasound_tb>\n      <lymph_node_biopsy multiple=\"0\" openmrs_concept=\"1769^LYMPH NODE BIOPSY^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </lymph_node_biopsy>\n      <paracentesis multiple=\"0\" openmrs_concept=\"1770^PARACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </paracentesis>\n      <thoracentesis multiple=\"0\" openmrs_concept=\"1771^THORACENTESIS^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </thoracentesis>\n      <purified_protein_derivative multiple=\"0\" openmrs_concept=\"1772^PURIFIED PROTEIN DERIVATIVE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </purified_protein_derivative>\n      <gastric_levage multiple=\"0\" openmrs_concept=\"1773^GASTRIC LEVAGE^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </gastric_levage>\n      <test_other multiple=\"0\" openmrs_concept=\"1774^TEST, OTHER^99DCT\" openmrs_datatype=\"CWE\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </test_other>\n      <bailey_months openmrs_concept=\"1515^BAILEY MONTHS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </bailey_months>\n      <weight_kg openmrs_concept=\"5089^WEIGHT (KG)^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </weight_kg>\n      <number_of_layers openmrs_concept=\"2056^NUMBER OF LAYERS^99DCT\" openmrs_datatype=\"NM\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </number_of_layers>\n    </tuberculosis_exams_set>\n    <date_of_administration_of_medication_for_tb_intensive_phase openmrs_concept=\"1650^DATE OF ADMINISTRATION OF MEDICATION FOR TB, INTENSIVE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_administration_of_medication_for_tb_intensive_phase>\n    <patient_reported_current_tuberculosis_treatment multiple=\"0\" openmrs_concept=\"1111^PATIENT REPORTED CURRENT TUBERCULOSIS TREATMENT^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </patient_reported_current_tuberculosis_treatment>\n    <date_of_tb_administration_of_medication_maintenance_phase openmrs_concept=\"2058^DATE OF TB ADMINISTRATION OF MEDICATION, MAINTENANCE PHASE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </date_of_tb_administration_of_medication_maintenance_phase>\n    <transfer_facility_names openmrs_concept=\"2061^TRANSFER, FACILITY NAMES^99DCT\" openmrs_datatype=\"ZZ\">\n      <transfer_from_other_facility_facility_name openmrs_concept=\"2060^TRANSFER FROM OTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transfer_from_other_facility_facility_name>\n      <transferred_out_to_another_facility_facility_name openmrs_concept=\"2059^TRANSFERRED OUT TO ANOTHER FACILITY, FACILITY NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </transferred_out_to_another_facility_facility_name>\n    </transfer_facility_names>\n    <entry_point_into_hiv_care_referal_type multiple=\"0\" openmrs_concept=\"1594^ENTRY POINT INTO HIV CARE, REFERAL TYPE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </entry_point_into_hiv_care_referal_type>\n    <hospital_slash_clinic openmrs_concept=\"1468^HOSPITAL/CLINIC^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hospital_slash_clinic>\n    <personal_reference openmrs_concept=\"1609^PERSONAL REFERENCE^99DCT\" openmrs_datatype=\"ZZ\">\n      <personal_reference_-_name openmrs_concept=\"1441^PERSONAL REFERENCE - NAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_name>\n      <personal_reference_-_surname openmrs_concept=\"1442^PERSONAL REFERENCE - SURNAME^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_surname>\n      <personal_reference_-_telephone_number openmrs_concept=\"1611^PERSONAL REFERENCE - TELEPHONE NUMBER^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_telephone_number>\n      <personal_reference_-_address openmrs_concept=\"2067^PERSONAL REFERENCE - ADDRESS^99DCT\" openmrs_datatype=\"ST\">\n            <date xsi:nil=\"true\"/>\n            <time xsi:nil=\"true\"/>\n            <value xsi:nil=\"true\"/>\n      </personal_reference_-_address>\n    </personal_reference>\n    <is_patient_hiv_positive multiple=\"0\" openmrs_concept=\"1634^IS PATIENT HIV POSITIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </is_patient_hiv_positive>\n    <cotrimoxazole_use multiple=\"1\" openmrs_concept=\"1534^PROPYLAXIS^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\n    </cotrimoxazole_use>\n    <day_hospital openmrs_concept=\"1797^DAY HOSPITAL^99DCT\" openmrs_datatype=\"ST\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </day_hospital>\n    <historical_drug_start_date openmrs_concept=\"1190^HISTORICAL DRUG START DATE^99DCT\" openmrs_datatype=\"DT\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </historical_drug_start_date>\n    <reason_tuberculosis_treatment_stopped multiple=\"0\" openmrs_concept=\"1269^REASON TUBERCULOSIS TREATMENT STOPPED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </reason_tuberculosis_treatment_stopped>\n    <hiv_rapid_test_1_qualitative multiple=\"0\" openmrs_concept=\"1040^HIV RAPID TEST 1, QUALITATIVE^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </hiv_rapid_test_1_qualitative>\n    <tuberculosis_prophylaxis_started multiple=\"1\" openmrs_concept=\"1264^TUBERCULOSIS PROPHYLAXIS STARTED^99DCT\" openmrs_datatype=\"CWE\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <isoniazid openmrs_concept=\"656^ISONIAZID^99DCT\">false</isoniazid>\n        <trimethoprim_and_sulfamethoxazole openmrs_concept=\"916^TRIMETHOPRIM AND SULFAMETHOXAZOLE^99DCT\">false</trimethoprim_and_sulfamethoxazole>\n    </tuberculosis_prophylaxis_started>\n    <number_of_children openmrs_concept=\"5573^NUMBER OF CHILDREN^99DCT\" openmrs_datatype=\"NM\">\n        <date xsi:nil=\"true\"/>\n        <time xsi:nil=\"true\"/>\n        <value xsi:nil=\"true\"/>\n    </number_of_children>\n  </obs>\n  <other/></form>','<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n\r\n<!--\r\nOpenMRS FormEntry Form HL7 Translation\r\n\r\nThis XSLT is used to translate OpenMRS forms from XML into HL7 2.5 format\r\n\r\n@author Burke Mamlin, MD\r\n@author Ben Wolfe\r\n@version 1.9.7\r\n\r\n1.9.7 - moved encounter/encounter.encounter_id to use PV1-19 instead\r\n1.9.6 - added encounter/encounter.encounter_id to PV1-1\r\n1.9.5 - allow for organizing sections under \"obs\" section\r\n1.9.4 - add support for message uid (as HL7 control id) and transform of patient.health_center to Discharge to Location (PV1-37)\r\n1.9.3 - fixed rounding error on timestamp (tenths of seconds getting rounded up, causing \"60\" seconds in some cases) \r\n1.9.2 - first generally useful version\r\n-->\r\n\r\n<xsl:stylesheet version=\"2.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\" xmlns:xs=\"http://www.w3.org/2001/XMLSchema\" xmlns:fn=\"http://www.w3.org/2005/xpath-functions\" xmlns:xdt=\"http://www.w3.org/2005/xpath-datatypes\">\r\n	<xsl:output method=\"text\" version=\"1.0\" encoding=\"UTF-8\" indent=\"no\"/>\r\n\r\n<xsl:variable name=\"SENDING-APPLICATION\">FORMENTRY</xsl:variable>\r\n<xsl:variable name=\"SENDING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-APPLICATION\">HL7LISTENER</xsl:variable>\r\n<xsl:variable name=\"RECEIVING-FACILITY\">AMRS.ELD</xsl:variable>\r\n<xsl:variable name=\"PATIENT-AUTHORITY\"></xsl:variable> <!-- leave blank for internal id, max 20 characters -->\r\n                                                       <!-- for now, must match patient_identifier_type.name -->\r\n<xsl:variable name=\"FORM-AUTHORITY\">AMRS.ELD.FORMID</xsl:variable> <!-- max 20 characters -->\r\n\r\n<xsl:template match=\"/\">\r\n	<xsl:apply-templates />\r\n</xsl:template>\r\n\r\n<!-- Form template -->\r\n<xsl:template match=\"form\">\r\n	<!-- MSH Header -->\r\n	<xsl:text>MSH|^~\\&amp;</xsl:text>   <!-- Message header, field separator, and encoding characters -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-3 Sending application -->\r\n	<xsl:value-of select=\"$SENDING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-4 Sending facility -->\r\n	<xsl:value-of select=\"$SENDING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-5 Receiving application -->\r\n	<xsl:value-of select=\"$RECEIVING-APPLICATION\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-6 Receiving facility -->\r\n	<xsl:value-of select=\"$RECEIVING-FACILITY\" />\r\n	<xsl:text>|</xsl:text>              <!-- MSH-7 Date/time message sent -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- MSH-8 Security -->\r\n	<xsl:text>|ORU^R01</xsl:text>       <!-- MSH-9 Message type ^ Event type (observation report unsolicited) -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-10 Message control ID -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"header/uid\">\r\n			<xsl:value-of select=\"header/uid\" />\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"patient/patient.patient_id\" />\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"current-dateTime()\" />\r\n			</xsl:call-template>\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|P</xsl:text>             <!-- MSH-11 Processing ID -->\r\n	<xsl:text>|2.5</xsl:text>           <!-- MSH-12 HL7 version -->\r\n	<xsl:text>|1</xsl:text>             <!-- MSH-13 Message sequence number -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-14 Continuation Pointer -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-15 Accept Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-16 Application Acknowledgement Type -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-17 Country Code -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-18 Character Set -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-19 Principal Language of Message -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-20 Alternate Character Set Handling Scheme -->\r\n	<xsl:text>|</xsl:text>              <!-- MSH-21 Message Profile Identifier -->\r\n	<xsl:value-of select=\"@id\" />\r\n	<xsl:text>^</xsl:text>\r\n	<xsl:value-of select=\"$FORM-AUTHORITY\" />\r\n	<xsl:text>&#x000d;</xsl:text>\r\n\r\n	<!-- PID header -->\r\n	<xsl:text>PID</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-1 Set ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-2 (deprecated) Patient ID -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-3 Patient Identifier List -->\r\n	<xsl:call-template name=\"patient_id\">\r\n		<xsl:with-param name=\"pid\" select=\"patient/patient.patient_id\" />\r\n		<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n		<xsl:with-param name=\"type\" select=\"L\" />\r\n	</xsl:call-template>\r\n	<xsl:if test=\"patient/patient.previous_mrn and string-length(patient/patient.previous_mrn) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.previous_mrn\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"PRIOR\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<!-- Additional patient identifiers -->\r\n	<!-- This example is for an MTCT-PLUS identifier used in the AMPATH project in Kenya (skipped if not present) -->\r\n	<xsl:if test=\"patient/patient.mtctplus_id and string-length(patient/patient.mtctplus_id) > 0\">\r\n		<xsl:text>~</xsl:text>\r\n		<xsl:call-template name=\"patient_id\">\r\n			<xsl:with-param name=\"pid\" select=\"patient/patient.mtctplus_id\" />\r\n			<xsl:with-param name=\"auth\" select=\"$PATIENT-AUTHORITY\" />\r\n			<xsl:with-param name=\"type\" select=\"MTCTPLUS\" />\r\n		</xsl:call-template>\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PID-4 (deprecated) Alternate patient ID -->\r\n	<!-- PID-5 Patient name -->\r\n	<xsl:text>|</xsl:text>              <!-- Family name -->\r\n	<xsl:value-of select=\"patient/patient.family_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Given name -->\r\n	<xsl:value-of select=\"patient/patient.given_name\" />\r\n	<xsl:text>^</xsl:text>              <!-- Middle name -->\r\n	<xsl:value-of select=\"patient/patient.middle_name\" />\r\n	<xsl:text>|</xsl:text>              <!-- PID-6 Mother\'s maiden name -->\r\n	<xsl:text>|</xsl:text>              <!-- PID-7 Date/Time of Birth -->\r\n	<xsl:value-of select=\"patient/patient.date_of_birth\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n	<!-- PV1 header -->\r\n	<xsl:text>PV1</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-1 Sub ID -->\r\n	<xsl:text>|O</xsl:text>             <!-- PV1-2 Patient class (O = outpatient) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-3 Patient location -->\r\n	<xsl:value-of select=\"encounter/encounter.location_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-4 Admission type (2 = return) -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-5 Pre-Admin Number -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-6 Prior Patient Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-7 Attending Doctor -->\r\n	<xsl:value-of select=\"encounter/encounter.provider_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-8 Referring Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-9 Consulting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-10 Hospital Service -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-11 Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-12 Preadmin Test Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-13 Re-adminssion Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-14 Admit Source -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-15 Ambulatory Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-16 VIP Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-17 Admitting Doctor -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-18 Patient Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-19 Visit Number -->\r\n	<xsl:value-of select=\"encounter/encounter.encounter_id\" />\r\n	<xsl:text>|</xsl:text>              <!-- PV1-20 Financial Class -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-21 Charge Price Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-22 Courtesy Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-23 Credit Rating -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-24 Contract Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-25 Contract Effective Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-26 Contract Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-27 Contract Period -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-28 Interest Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-29 Transfer to Bad Debt Code -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-30 Transfer to Bad Debt Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Agency Code -->\r\n  <xsl:text>|</xsl:text>              <!-- PV1-31 Bad Debt Transfer Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-33 Bad Debt Recovery Amount -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-34 Delete Account Indicator -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-35 Delete Account Date -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-36 Discharge Disposition -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-37 Discharge To Location -->\r\n	<xsl:if test=\"patient/patient.health_center\">\r\n		<xsl:value-of select=\"replace(patient/patient.health_center,\'\\^\',\'&amp;\')\" />\r\n	</xsl:if>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-38 Diet Type -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-39 Servicing Facility -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-40 Bed Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-41 Account Status -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-42 Pending Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-43 Prior Temporary Location -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-44 Admit Date/Time -->\r\n	<xsl:call-template name=\"hl7Date\">\r\n		<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- PV1-45 Discharge Date/Time -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-46 Current Patient Balance -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-47 Total Charges -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-48 Total Adjustments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-49 Total Payments -->\r\n	<xsl:text>|</xsl:text>              <!-- PV1-50 Alternate Visit ID -->\r\n	<xsl:text>|V</xsl:text>             <!-- PV1-51 Visit Indicator -->\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- We use encounter date as the timestamp for each observation -->\r\n	<xsl:variable name=\"encounterTimestamp\">\r\n		<xsl:call-template name=\"hl7Date\">\r\n			<xsl:with-param name=\"date\" select=\"encounter/encounter.encounter_datetime\" />\r\n		</xsl:call-template>\r\n	</xsl:variable>\r\n	\r\n	<!-- ORC Common Order Segment -->\r\n	<xsl:text>ORC</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|RE</xsl:text>            <!-- ORC-1 Order Control (RE = obs to follow) -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-2 Placer Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-3 Filler Order Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-4 Placer Group Number -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-5 Order Status -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-6 Response Flag -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-7 Quantity/Timing -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-8 Parent -->\r\n	<xsl:text>|</xsl:text>              <!-- ORC-9 Date/Time of Transaction -->\r\n	<xsl:call-template name=\"hl7Timestamp\">\r\n		<xsl:with-param name=\"date\" select=\"xs:dateTime(header/date_entered)\" />\r\n	</xsl:call-template>\r\n	<xsl:text>|</xsl:text>              <!-- ORC-10 Entered By -->\r\n	<xsl:value-of select=\"header/enterer\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- Observation(s) -->\r\n	<!-- <xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" /> -->\r\n	<xsl:variable name=\"obsList\" select=\"obs/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]|obs/*[not(@openmrs_concept)]/*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\" />\r\n	<xsl:variable name=\"obsListCount\" select=\"count($obsList)\" as=\"xs:integer\" />\r\n	<!-- Observation OBR -->\r\n	<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n	<xsl:text>1</xsl:text>\r\n	<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n	<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n	<xsl:value-of select=\"obs/@openmrs_concept\" />\r\n	<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n	<!-- observation OBXs -->\r\n	<xsl:for-each select=\"$obsList\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"value\">\r\n				<xsl:call-template name=\"obsObx\">\r\n					<xsl:with-param name=\"setId\" select=\"position()\" />\r\n					<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n					<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n					<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n					<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n					<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n					<xsl:with-param name=\"value\" select=\"value\" />\r\n					<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n				<xsl:variable name=\"setId\" select=\"position()\" />\r\n				<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n						<xsl:with-param name=\"subId\" select=\"concat($setId,position())\" />\r\n						<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:for-each>\r\n			</xsl:otherwise>\r\n		</xsl:choose>\r\n	</xsl:for-each>\r\n	\r\n	<!-- Grouped observation(s) -->\r\n	<!-- <xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" /> -->\r\n	<xsl:variable name=\"obsGroupList\" select=\"obs/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]|obs/*[not(@openmrs_concept)]/*[@openmrs_concept and not(date) and *[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]]\" />\r\n	<xsl:variable name=\"obsGroupListCount\" select=\"count($obsGroupList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$obsGroupList\">\r\n		<!-- Observation OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + position()\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n		\r\n		<!-- Generate OBXs -->\r\n		<xsl:for-each select=\"*[(@openmrs_concept and value and value/text() != \'\') or *[@openmrs_concept and text()=\'true\']]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"subId\" select=\"1\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"concat(\'1.\',position())\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>\r\n	</xsl:for-each>\r\n\r\n	<!-- Problem list(s) -->\r\n	<xsl:variable name=\"problemList\" select=\"problem_list/*[value[text() != \'\']]\" />\r\n	<xsl:variable name=\"problemListCount\" select=\"count($problemList)\" as=\"xs:integer\" />\r\n	<xsl:if test=\"$problemList\">\r\n		<!-- Problem list OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"problem_list/@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n\r\n		<!-- Problem list OBXs -->\r\n		<xsl:for-each select=\"$problemList\">\r\n			<xsl:call-template name=\"obsObx\">\r\n				<xsl:with-param name=\"setId\" select=\"position()\" />\r\n				<xsl:with-param name=\"datatype\" select=\"\'CWE\'\" />\r\n				<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n				<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n				<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n				<xsl:with-param name=\"value\" select=\"value\" />\r\n				<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n			</xsl:call-template>		\r\n		</xsl:for-each>\r\n	</xsl:if>\r\n	\r\n	<!-- Orders -->\r\n	<xsl:variable name=\"orderList\" select=\"orders/*[*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]]\" />\r\n	<xsl:variable name=\"orderListCount\" select=\"count($orderList)\" as=\"xs:integer\" />\r\n	<xsl:for-each select=\"$orderList\">\r\n		<!-- Order section OBR -->\r\n		<xsl:text>OBR</xsl:text>            <!-- Message type -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-1 Set ID -->\r\n		<xsl:value-of select=\"$obsListCount + $obsGroupListCount + $problemListCount + 1\" />\r\n		<xsl:text>|</xsl:text>              <!-- OBR-2 Placer order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-3 Filler order number -->\r\n		<xsl:text>|</xsl:text>              <!-- OBR-4 OBR concept -->\r\n		<xsl:value-of select=\"@openmrs_concept\" />\r\n		<xsl:text>&#x000d;</xsl:text>       <!-- new line -->\r\n	\r\n		<!-- Order OBXs -->\r\n		<xsl:for-each select=\"*[@openmrs_concept and ((value and value/text() != \'\') or *[@openmrs_concept and text() = \'true\'])]\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"value\">\r\n					<xsl:call-template name=\"obsObx\">\r\n						<xsl:with-param name=\"setId\" select=\"position()\" />\r\n						<xsl:with-param name=\"datatype\" select=\"@openmrs_datatype\" />\r\n						<xsl:with-param name=\"units\" select=\"@openmrs_units\" />\r\n						<xsl:with-param name=\"concept\" select=\"@openmrs_concept\" />\r\n						<xsl:with-param name=\"date\" select=\"date/text()\" />\r\n						<xsl:with-param name=\"time\" select=\"time/text()\" />\r\n						<xsl:with-param name=\"value\" select=\"value\" />\r\n						<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n					</xsl:call-template>\r\n				</xsl:when>\r\n				<xsl:otherwise>\r\n					<xsl:variable name=\"setId\" select=\"position()\" />\r\n					<xsl:for-each select=\"*[@openmrs_concept and text() = \'true\']\">\r\n						<xsl:call-template name=\"obsObx\">\r\n							<xsl:with-param name=\"setId\" select=\"$setId\" />\r\n							<xsl:with-param name=\"subId\" select=\"position()\" />\r\n							<xsl:with-param name=\"datatype\" select=\"../@openmrs_datatype\" />\r\n							<xsl:with-param name=\"units\" select=\"../@openmrs_units\" />\r\n							<xsl:with-param name=\"concept\" select=\"../@openmrs_concept\" />\r\n							<xsl:with-param name=\"date\" select=\"../date/text()\" />\r\n							<xsl:with-param name=\"time\" select=\"../time/text()\" />\r\n							<xsl:with-param name=\"value\" select=\"@openmrs_concept\" />\r\n							<xsl:with-param name=\"encounterTimestamp\" select=\"$encounterTimestamp\" />\r\n						</xsl:call-template>\r\n					</xsl:for-each>\r\n				</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:for-each>	\r\n	</xsl:for-each>\r\n	\r\n</xsl:template>\r\n\r\n<!-- Patient Identifier (CX) generator -->\r\n<xsl:template name=\"patient_id\">\r\n	<xsl:param name=\"pid\" />\r\n	<xsl:param name=\"auth\" />\r\n	<xsl:param name=\"type\" />\r\n	<xsl:value-of select=\"$pid\" />\r\n	<xsl:text>^</xsl:text>              <!-- Check digit -->\r\n	<xsl:text>^</xsl:text>              <!-- Check Digit Scheme -->\r\n	<xsl:text>^</xsl:text>              <!-- Assigning Authority -->\r\n	<xsl:value-of select=\"$auth\" />\r\n	<xsl:text>^</xsl:text>              <!-- Identifier Type -->\r\n	<xsl:value-of select=\"$type\" />\r\n</xsl:template>\r\n\r\n<!-- OBX Generator -->\r\n<xsl:template name=\"obsObx\">\r\n	<xsl:param name=\"setId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"subId\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"datatype\" required=\"yes\" />\r\n	<xsl:param name=\"concept\" required=\"yes\" />\r\n	<xsl:param name=\"date\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"time\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"value\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"units\" required=\"no\"></xsl:param>\r\n	<xsl:param name=\"encounterTimestamp\" required=\"yes\" />\r\n	<xsl:text>OBX</xsl:text>                     <!-- Message type -->\r\n	<xsl:text>|</xsl:text>                       <!-- Set ID -->\r\n	<xsl:value-of select=\"$setId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Observation datatype -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:text>NM</xsl:text>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$datatype\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Concept (what was observed -->\r\n	<xsl:value-of select=\"$concept\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Sub-ID -->\r\n	<xsl:value-of select=\"$subId\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Value -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$datatype = \'TS\'\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'DT\'\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'TM\'\">\r\n			<xsl:call-template name=\"hl7Time\">\r\n				<xsl:with-param name=\"time\" select=\"$value\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$datatype = \'BIT\'\">\r\n			<xsl:choose>\r\n				<xsl:when test=\"$value = \'0\' or upper-case($value) = \'FALSE\'\">0</xsl:when>\r\n				<xsl:otherwise>1</xsl:otherwise>\r\n			</xsl:choose>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$value\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>|</xsl:text>                       <!-- Units -->\r\n	<xsl:value-of select=\"$units\" />\r\n	<xsl:text>|</xsl:text>                       <!-- Reference range -->\r\n	<xsl:text>|</xsl:text>                       <!-- Abnormal flags -->\r\n	<xsl:text>|</xsl:text>                       <!-- Probability -->\r\n	<xsl:text>|</xsl:text>                       <!-- Nature of abnormal test -->\r\n	<xsl:text>|</xsl:text>                       <!-- Observation result status -->\r\n	<xsl:text>|</xsl:text>                       <!-- Effective date -->\r\n	<xsl:text>|</xsl:text>                       <!-- User defined access checks -->\r\n	<xsl:text>|</xsl:text>                       <!-- Date time of observation -->\r\n	<xsl:choose>\r\n		<xsl:when test=\"$date and $time\">\r\n			<xsl:call-template name=\"hl7Timestamp\">\r\n				<xsl:with-param name=\"date\" select=\"dateTime($date,$time)\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:when test=\"$date\">\r\n			<xsl:call-template name=\"hl7Date\">\r\n				<xsl:with-param name=\"date\" select=\"$date\" />\r\n			</xsl:call-template>\r\n		</xsl:when>\r\n		<xsl:otherwise>\r\n			<xsl:value-of select=\"$encounterTimestamp\" />\r\n		</xsl:otherwise>\r\n	</xsl:choose>\r\n	<xsl:text>&#x000d;</xsl:text>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted timestamp -->\r\n<xsl:template name=\"hl7Timestamp\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:value-of select=\"concat(year-from-dateTime($date),format-number(month-from-dateTime($date),\'00\'),format-number(day-from-dateTime($date),\'00\'),format-number(hours-from-dateTime($date),\'00\'),format-number(minutes-from-dateTime($date),\'00\'),format-number(floor(seconds-from-dateTime($date)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted date -->\r\n<xsl:template name=\"hl7Date\">\r\n	<xsl:param name=\"date\" />\r\n	<xsl:if test=\"string($date) != \'\'\">\r\n		<xsl:choose>\r\n			<xsl:when test=\"contains(string($date),\'T\')\">\r\n				<xsl:call-template name=\"hl7Date\">\r\n					<xsl:with-param name=\"date\" select=\"xs:date(substring-before($date,\'T\'))\" />\r\n				</xsl:call-template>\r\n			</xsl:when>\r\n			<xsl:otherwise>\r\n					<xsl:value-of select=\"concat(year-from-date($date),format-number(month-from-date($date),\'00\'),format-number(day-from-date($date),\'00\'))\" />\r\n			</xsl:otherwise>\r\n		</xsl:choose>				\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n<!-- Generate HL7-formatted time -->\r\n<xsl:template name=\"hl7Time\">\r\n	<xsl:param name=\"time\" />\r\n	<xsl:if test=\"$time != \'\'\">\r\n		<xsl:value-of select=\"concat(format-number(hours-from-time($time),\'00\'),format-number(minutes-from-time($time),\'00\'),format-number(floor(seconds-from-time($time)),\'00\'))\" />\r\n	</xsl:if>\r\n</xsl:template>\r\n\r\n</xsl:stylesheet>',1,'2006-07-18 11:02:38',13,'2011-01-11 15:24:17',0,NULL,NULL,NULL,'e2901708-1d5f-11e0-b929-000c29ad1d07'),(99,'ADULTO: PROCESSO PARTE A - ANAMNESE','1.0',NULL,1,'Processo clinico, serviço TARV, Adulto: as duas primeiras paginas',5,NULL,NULL,13,'2011-01-11 15:30:20',1,'2017-01-27 09:10:55',0,NULL,NULL,NULL,'527a5141-2931-4546-b789-14125d30545a'),(100,'ADULTO: PROCESSO PARTE B - EXAME CLINICO','1.0',NULL,1,'Processo clinico, servico TARV, adulto: as duas ultimas paginas',1,NULL,NULL,13,'2011-01-11 15:42:49',13,'2012-03-27 13:43:08',0,NULL,NULL,NULL,'d3bda8e6-25f2-4fb9-a7cb-5c0cae4276de'),(101,'ADULTO: SEGUIMENTO','1.0',NULL,1,'Ficha de seguimento de pacientes no serviço TARV: Adulto',6,NULL,NULL,13,'2011-01-11 15:49:00',13,'2012-06-26 13:33:42',1,13,'2012-06-26 13:33:42','Existe nova ficha de seguimento','8498935e-a226-478b-a24a-ac0265187ec0'),(102,'ATS','1.0',NULL,0,'Aconselhamento e testagem em saude.',14,NULL,NULL,13,'2011-01-11 17:08:51',13,'2011-05-26 12:33:56',0,NULL,NULL,NULL,'ac6d2a83-7879-4bf5-89ab-ff16b1805d43'),(103,'BUSCA ACTIVA','1.0',NULL,0,'Formulario de busca activa',21,NULL,NULL,13,'2011-01-11 17:15:29',13,'2011-05-26 12:34:38',0,NULL,NULL,NULL,'e90e66d8-8651-4b55-8c8e-6a75ae7719be'),(104,'CCR: PROCESSO','1.0',NULL,0,'Processo de consulta de crianças em risco',8,NULL,NULL,13,'2011-01-11 17:17:54',13,'2013-12-13 17:16:03',0,NULL,NULL,NULL,'bc06725c-2aba-42eb-9a5e-089d46eaae1c'),(105,'CCR: SEGUIMENTO','1.0',NULL,0,'Seguimento de consulta de crianças em risco',10,NULL,NULL,13,'2011-01-11 17:21:30',13,'2013-12-13 17:16:21',0,NULL,NULL,NULL,'60c02a76-6f1e-486c-95c2-a147cec0895d'),(106,'LABORATORIO GERAL','1.0',NULL,1,'Ficha geral (de todos programas) para registo de resultados de exames laboratoriais',13,NULL,NULL,13,'2011-01-11 17:23:53',13,'2012-01-14 13:05:23',0,NULL,NULL,NULL,'8377e4ff-d0fe-44a5-81c3-74c9040fd5f8'),(107,'PCR','1.0',NULL,0,'Ficha de colheita de amostras e resultado de PCR',22,NULL,NULL,13,'2011-01-11 17:28:20',13,'2011-05-26 12:43:55',0,NULL,NULL,NULL,'342dd283-0475-44fc-aea9-304fac6e1be4'),(108,'PEDIATRIA: PROCESSO PARTE A - ANAMNESE','1.0',NULL,1,'Processo clinico, serviço TARV, Pediatria: as duas primeiras paginas',7,NULL,NULL,13,'2011-01-11 17:30:45',13,'2012-02-29 17:24:59',0,NULL,NULL,NULL,'6c620a7b-50d1-44a0-a1db-3258dd1194d1'),(109,'PEDIATRIA: PROCESSO PARTE B - EXAME CLINICO','1.0',NULL,1,'Processo clinico, serviço TARV, Pediatria: as duas ultimas paginas',3,NULL,NULL,13,'2011-01-11 17:35:47',13,'2013-12-12 17:52:59',0,NULL,NULL,NULL,'a7171965-0189-4174-9b0a-d58d557d5aec'),(110,'PEDIATRIA: SEGUIMENTO','1.0',NULL,1,'Ficha de seguimento, Servico TARV, Pediatria',9,NULL,NULL,13,'2011-01-11 17:41:23',13,'2012-06-26 13:18:28',1,13,'2012-06-26 13:18:28','Existe nova ficha de seguimento','04b49755-e494-4db0-98ba-f4449656b8c1'),(111,'PTV: PRE-NATAL','1.0',NULL,0,'Livro de registo na PTV, Consulta Pré-natal',11,NULL,NULL,13,'2011-01-12 12:40:35',13,'2013-12-13 17:35:43',0,NULL,NULL,NULL,'799c6994-4a46-4d51-b671-bd983f03143f'),(112,'PTV: PRE-NATAL - NOVO','1.0',NULL,0,'Livro de registo de PTV, Pré-natal, Novo',11,NULL,NULL,13,'2011-01-12 12:42:50',13,'2011-05-26 13:48:56',0,NULL,NULL,NULL,'b40e887f-9f21-4c85-9c58-3965eaba7160'),(113,'PTV: MATERNIDADE','1.0',NULL,0,'Livro de registo de PTV, Maternidade',23,NULL,NULL,13,'2011-01-12 12:45:10',13,'2013-12-13 17:35:20',0,NULL,NULL,NULL,'4dab74bf-efda-46d9-95c4-7ad5b96c356a'),(114,'PTV: MATERNIDADE - NOVO','1.0',NULL,0,'Livro de registo de PTV, Maternidade, Novo',23,NULL,NULL,13,'2011-01-12 12:46:52',13,'2011-05-26 13:51:08',0,NULL,NULL,NULL,'475f73d2-2085-4123-affe-2895fe525556'),(115,'TARV: ACONSELHAMENTO','1.0',NULL,0,'Ficha de aconselhamento, TARV e Pré-TARV',19,NULL,NULL,13,'2011-01-12 12:50:51',13,'2013-12-13 17:36:04',0,NULL,NULL,NULL,'e702ee08-7ab8-4c93-92dc-d77570af854b'),(116,'TARV: ACONSELHAMENTO SEGUIMENTO','1.0',NULL,1,'Seguimento de aconselhamento, TARV e Pré-TARV',24,NULL,NULL,13,'2011-01-12 12:57:26',13,'2011-05-26 12:26:20',0,NULL,NULL,NULL,'43784dad-a494-45b8-a4b3-f313a3c84c70'),(117,'TARV: FRIDA','1.0',NULL,0,'Ficha de Registo Individual de Despesas de ARV',18,NULL,NULL,13,'2011-01-12 13:00:58',13,'2013-12-13 17:39:03',0,NULL,NULL,NULL,'0450f11d-3ac5-451c-8e82-1c79868bc88f'),(118,'TARV: RASTREIO DE TUBERCULOSE','1.0',NULL,0,'Ficha de rastreio de tuberculose para pacientes HIV+',20,NULL,NULL,13,'2011-01-12 13:04:31',13,'2013-12-13 17:39:26',0,NULL,NULL,NULL,'074bfef6-b048-4dd1-80a2-de6396918a3e'),(119,'TARV: SOLICITACAO','1.0',NULL,0,'Solicitação de ARV',17,NULL,NULL,13,'2011-01-12 13:06:48',13,'2013-12-13 17:39:59',0,NULL,NULL,NULL,'7d7b660b-bdba-4457-95b8-2b5d7b64fcab'),(120,'TUBERCULOSE: LIVRO','1.0',NULL,0,'Livro de registo de doentes com tuberculose, PNCT',25,NULL,NULL,13,'2011-01-12 13:10:35',13,'2013-12-13 17:42:12',0,NULL,NULL,NULL,'566be870-74ea-4d79-bad5-7e37d5f0931d'),(121,'TARV: VISITA DOMICILIARIA','1.0',NULL,1,'Visita domiciliaria/busca para pacientes na unidade sanitária',21,NULL,NULL,13,'2011-01-12 13:21:35',13,'2012-02-08 13:40:10',0,NULL,NULL,NULL,'b1ecb071-6471-4d87-89f4-d9e1b0c80630'),(122,'CCU: RASTREIO','1.0',NULL,1,'Rastreio de cancro do colo do utero',28,NULL,NULL,13,'2011-01-12 14:21:51',357,'2019-02-27 10:14:04',0,NULL,NULL,NULL,'5ce0e3ab-c88b-421e-9fbb-876c03ddef0f'),(123,'TARV: AVALICAO E PREPARACAO DO CANDIDATO AO TARV','1.0',NULL,1,'Ficha de avaliacao e preparacao psicologica do candidato ao TARV',29,NULL,NULL,13,'2011-09-09 10:18:59',13,'2014-04-21 14:29:30',0,NULL,NULL,NULL,'dc1e3f95-57a4-4b0b-9686-11e19f2bc5ab'),(124,'TARV: AVALIACAO DE ADESAO','1.0',NULL,1,'Formulario de avaliacao de ADESAO para pacientes em TARV',31,NULL,NULL,13,'2011-09-12 16:44:35',13,'2013-12-13 17:58:20',0,NULL,NULL,NULL,'f8d1f33c-fdab-4bc7-a8c5-594302c177f7'),(125,'TARV: TERMO DE CONSENTIMENTO','1.0',NULL,1,'Termo de consentimento de visita domiciliaria e Busca activa',30,NULL,NULL,13,'2011-09-14 10:00:40',13,'2012-06-26 13:36:56',0,NULL,NULL,NULL,'4b9c4669-4ff8-4cb7-a180-f40cc0ac30dd'),(126,'ADULTO: SEGUIMENTO','0.1',NULL,1,'Ficha de Seguimento para Adultos no Serviço TARV',6,NULL,NULL,1,'2012-02-22 14:46:22',13,'2013-12-13 06:28:55',0,NULL,NULL,NULL,'78d47629-5ac4-4e16-8972-2166eef30bfd'),(127,'PEDIATRIA: SEGUIMENTO','0.1',NULL,1,'Nova ficha de seguimento para criança',9,NULL,NULL,1,'2012-02-22 16:05:56',13,'2013-07-01 09:39:25',0,NULL,NULL,NULL,'ff79c06c-2403-4cf6-9d78-fc6fabcad3b7'),(128,'LIVRO DE REGISTO PRE-TARV','1.0',NULL,1,'Representa o livro de registo (1,2) PRE-TARV',32,NULL,NULL,13,'2012-02-29 17:18:59',13,'2013-12-13 17:17:14',0,NULL,NULL,NULL,'fbb1f0ed-1cf5-4e12-b7ee-bd8653c54e9b'),(129,'LIVRO DE REGISTO TARV','1.0',NULL,1,'Representa o livro de registo (1,2) TARV',33,NULL,NULL,13,'2012-02-29 17:27:54',13,'2013-12-13 08:22:27',0,NULL,NULL,NULL,'f81b9361-a4a4-4895-94a1-a9dc8db06e1b'),(130,'FILA','1.0',NULL,1,'Ficha Individual de Levantamento de ARVs',18,NULL,NULL,13,'2012-05-31 16:33:18',13,'2014-04-23 14:10:37',0,NULL,NULL,NULL,'49857ace-1a92-4980-8313-1067714df151'),(131,'TARV: AVALIAÇÃO PSICOLOGICA E PP - INICIAL','1.0',NULL,1,'Ficha de avaliação psicologica e prevenção positiva: Inicial',34,NULL,NULL,13,'2013-06-24 17:01:10',13,'2014-07-01 16:04:55',0,NULL,NULL,NULL,'7fe58112-e912-4c60-9c15-a110490488bc'),(132,'TARV: AVALIAÇÃO PSICOLOGICA E PP - SEGUIMENTO','1.0',NULL,1,'Ficha de avaliação psicologica e prevenção positiva: Seguimento',35,NULL,NULL,13,'2013-06-24 17:04:16',13,'2014-07-09 08:17:33',0,NULL,NULL,NULL,'ba229747-6382-475a-beb8-6f90bae8b120'),(133,'CPN_TESTE','1.0',NULL,0,'CPN_TESTE',10,NULL,NULL,1,'2016-07-29 09:05:43',NULL,NULL,0,NULL,NULL,NULL,'02a3d7d1-5058-49e1-9bea-33bc360c0b1c'),(134,'CCR - SMI','1.0',NULL,0,'Consulta de Crianca em risco  - Projecto MCH',10,NULL,NULL,271,'2016-01-13 13:36:14',1,'2016-10-11 15:51:19',0,1,'2016-10-11 15:51:19','obsoleto','3f9355a8-6e17-424f-9073-6191883d071f'),(135,'FICHA-ATS','1.0',NULL,0,'Aconselhamento e Testagem em Saúde',14,NULL,NULL,1,'2016-06-27 09:46:35',NULL,NULL,0,NULL,NULL,NULL,'f767009e-8a32-4af2-82f1-a385feb2d59d'),(136,'CPN_TESTE','1.0',NULL,0,'CPN_TESTE',10,NULL,NULL,1,'2016-07-27 13:03:33',1,'2016-10-11 15:54:12',0,1,'2016-10-11 15:54:12','obsoleto','008ea171-a26f-4bd9-a173-12f6f2d9cb73'),(137,'CCR_SEGUIMENTO','1.0',NULL,0,'CCR_SEGUIMENTO',10,NULL,NULL,1,'2016-07-27 13:14:12',NULL,NULL,0,NULL,NULL,NULL,'f243290f-eb4b-4352-9283-332f38413912'),(138,'CPN_ST_V1','1.1',NULL,0,'CPN_ST_V1',10,NULL,NULL,1,'2016-08-04 17:51:53',1,'2016-10-11 15:53:53',0,1,'2016-10-11 15:53:53','obsoleto','002edb91-7f43-4ac4-b676-6fcf613567ca'),(139,'POC: CURRENT STORY','1.0',NULL,0,NULL,45,NULL,NULL,13,'2016-08-01 08:11:41',13,'2016-10-20 19:50:39',0,NULL,NULL,NULL,'65896366-17b2-4c3e-9cce-440edcfe7b4e'),(140,'Testing_Schema_nico','1.0',NULL,0,'This contains all the schema that is needed',37,NULL,NULL,1,'2016-08-25 07:49:50',NULL,NULL,0,NULL,NULL,NULL,'0bcc57df-5b5c-4706-b9ff-3ffe0c033f02'),(144,'CCR-SMI','1.0',NULL,0,'Livro de Registo de Criança de Consulta em Risco',10,NULL,NULL,1,'2016-07-26 08:26:24',NULL,'2016-09-13 08:27:58',0,NULL,NULL,NULL,'c17115d7-5b97-4a43-a0b8-0a0ef49f4b59'),(145,'TESTE DO CASO DO INDICE DO PACIENTE','1.0',NULL,0,'Para capturar o consentimento do paciente',47,NULL,NULL,1,'2017-01-17 15:45:06',NULL,NULL,0,NULL,NULL,NULL,'b3267f06-15a9-4fc6-a20c-a95df426f2b5'),(146,'CONSENTIMENTO DE TESTE DE CASO INDICE','1.0',NULL,1,'Para capturar o consentimento do paciente',47,NULL,NULL,1,'2017-01-17 16:27:58',357,'2017-05-05 13:22:18',0,NULL,NULL,NULL,'25c7f95e-0685-43dd-9321-9c9092e35b69'),(163,'FICHA CLINICA','1.0',NULL,1,'Ficha Clinica  - MasterCard',6,NULL,NULL,1,'2018-11-05 12:58:20',1,'2019-09-02 10:17:14',0,NULL,NULL,NULL,'3c2d563a-5d37-4735-a125-d3943a3de30a'),(164,'FICHA APSS e PP','1.0',NULL,1,'Ficha Apoio Psicossocial e PP Master Card',35,NULL,NULL,1,'2018-11-07 09:42:30',1,'2019-09-02 10:16:44',0,NULL,NULL,NULL,'b8e74e5e-cce4-442e-bd61-86d2800e5956'),(165,'FICHA RESUMO','1.0',NULL,1,'Ficha Resumo  - MasterCards',53,NULL,NULL,1,'2018-11-21 11:13:14',1,'2019-09-02 10:18:34',0,NULL,NULL,NULL,'05496c70-845c-40b1-9d28-070f67b3f7da'),(166,'RECEPCAO - LEVANTOU TARV','1.0',NULL,1,'Ficha de registe de levantamento de ARV no Master Card',52,NULL,NULL,1,'2019-07-09 13:09:23',1,'2019-09-02 10:15:59',0,NULL,NULL,NULL,'06fd1a20-c67e-4eff-867a-bd90ca2e55bb');
/*!40000 ALTER TABLE `form` ENABLE KEYS */;
UNLOCK TABLES;
/*!40103 SET TIME_ZONE=@OLD_TIME_ZONE */;

/*!40101 SET SQL_MODE=@OLD_SQL_MODE */;
/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */;
/*!40014 SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */;

-- Dump completed on 2020-08-27  9:36:21
